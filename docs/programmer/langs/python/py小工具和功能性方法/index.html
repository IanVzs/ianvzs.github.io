<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="author:Ian
邮件 # 发送邮件时携带附件 中文名称附件
def send_email_week_report(htm, recipients, copys, file_name, file_path): port = 465 # str_today = datetime.now().strftime(&#34;%Y-%m-%d %H:%M:%S&#34;) str_today = datetime.now().strftime(&#34;%Y-%m-%d&#34;) mail_host = &#34;mail.{demo}.com&#34; mail_user = &#34;{user name}&#34; mail_pass = &#34;{passwd}&#34; sender = '{name}@{demo}.com' mail_from = &#34;{name} <{name}@{demo}.com>&#34; msg_Bcc = '{name}@{demo}.com' subject = f&#34;{title}-{str_today}&#34; # 标题 msg = MIMEMultipart() msg.attach(MIMEText(htm, 'html', 'utf-8')) # 这里可以传html内容 也可以传普通文字 # 创建附件 with open(file_path, 'rb') as attachment: part = MIMEBase('application', 'octet-stream') part.set_payload(attachment.read()) encoders.encode_base64(part) part.add_header( 'Content-Disposition', 'attachment', filename=(&#34;utf-8&#34;, &#34;&#34;, file_name), ) msg."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Py小工具和功能性方法"><meta property="og:description" content="author:Ian
邮件 # 发送邮件时携带附件 中文名称附件
def send_email_week_report(htm, recipients, copys, file_name, file_path): port = 465 # str_today = datetime.now().strftime(&#34;%Y-%m-%d %H:%M:%S&#34;) str_today = datetime.now().strftime(&#34;%Y-%m-%d&#34;) mail_host = &#34;mail.{demo}.com&#34; mail_user = &#34;{user name}&#34; mail_pass = &#34;{passwd}&#34; sender = '{name}@{demo}.com' mail_from = &#34;{name} <{name}@{demo}.com>&#34; msg_Bcc = '{name}@{demo}.com' subject = f&#34;{title}-{str_today}&#34; # 标题 msg = MIMEMultipart() msg.attach(MIMEText(htm, 'html', 'utf-8')) # 这里可以传html内容 也可以传普通文字 # 创建附件 with open(file_path, 'rb') as attachment: part = MIMEBase('application', 'octet-stream') part.set_payload(attachment.read()) encoders.encode_base64(part) part.add_header( 'Content-Disposition', 'attachment', filename=(&#34;utf-8&#34;, &#34;&#34;, file_name), ) msg."><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/docs/programmer/langs/python/py%E5%B0%8F%E5%B7%A5%E5%85%B7%E5%92%8C%E5%8A%9F%E8%83%BD%E6%80%A7%E6%96%B9%E6%B3%95/"><meta property="article:section" content="docs"><title>Py小工具和功能性方法 | Ian's Blog</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.80b0c12c6a3982c23bab5eb1d10c75b4cf8bfbaa1c7e183729648ce8a09207d7.js integrity="sha256-gLDBLGo5gsI7q16x0Qx1tM+L+6ocfhg3KWSM6KCSB9c=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Ian's Blog</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/docs/programmer/>程序员笔记</a><ul><li><input type=checkbox id=section-d5f99046a51e5e750b61f2e037945fcc class=toggle>
<label for=section-d5f99046a51e5e750b61f2e037945fcc class="flex justify-between"><a role=button>基础工具和配置</a></label><ul><li><a href=/docs/programmer/basetc/%E6%96%87%E6%9C%AC%E4%B8%89%E5%89%91%E5%AE%A2/>文本三剑客</a></li><li><a href=/docs/programmer/basetc/tmux/>Tmux使用笔记</a></li><li><a href=/docs/programmer/basetc/obsidian%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE%E6%8F%92%E4%BB%B6/>Obsidian思维导图插件</a></li><li><a href=/docs/programmer/basetc/for_china/>各个软件换源</a></li><li><a href=/docs/programmer/basetc/tipsofvim/>tip Of vim</a></li><li><a href=/docs/programmer/basetc/editer/>编辑器使用</a></li><li><a href=/docs/programmer/basetc/bash/>Bash</a></li><li><a href=/docs/programmer/basetc/gitbook/>Gitbook</a></li><li><a href=/docs/programmer/basetc/vim/>Vim</a></li><li><a href=/docs/programmer/basetc/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/>supervisor</a></li></ul></li><li><input type=checkbox id=section-8658298e10b544e890095f646916165a class=toggle>
<label for=section-8658298e10b544e890095f646916165a class="flex justify-between"><a href=/docs/programmer/cloudnative/>云原生</a></label><ul><li><input type=checkbox id=section-31d3b02fd4a132635e483e7e756058ea class=toggle>
<label for=section-31d3b02fd4a132635e483e7e756058ea class="flex justify-between"><a href=/docs/programmer/cloudnative/redis/>中间件</a></label><ul><li><a href=/docs/programmer/cloudnative/redis/python-redis-%E5%AE%A2%E6%88%B7%E7%AB%AF/>Python Redis 客户端</a></li><li><a href=/docs/programmer/cloudnative/redis/bigkey-and-hotkey/>大key、热key问题</a></li><li><a href=/docs/programmer/cloudnative/redis/the-basics-of-redis/>Redis基础</a></li><li><a href=/docs/programmer/cloudnative/redis/advanced-knowledge-of-redis/>Redis进阶</a></li><li><a href=/docs/programmer/cloudnative/redis/%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4/>Redis常用命令</a></li></ul></li><li><input type=checkbox id=section-62d608ed890b3abc76dae78ccfcab912 class=toggle>
<label for=section-62d608ed890b3abc76dae78ccfcab912 class="flex justify-between"><a role=button>k8s</a></label><ul><li><a href=/docs/programmer/cloudnative/k8s/elk%E5%9C%A8k8s%E4%B8%8A%E7%9A%84%E9%83%A8%E7%BD%B2%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/>elk在k8s上的部署使用示例</a></li><li><a href=/docs/programmer/cloudnative/k8s/k8s-%E9%85%8D%E5%A5%97%E8%AF%B4%E6%98%8E/>k8s 配套说明</a></li><li><a href=/docs/programmer/cloudnative/k8s/k8s-%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/>k8s技术分享</a></li><li><a href=/docs/programmer/cloudnative/k8s/k8s%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/>k8s学习-常用命令和配置文件</a></li><li><a href=/docs/programmer/cloudnative/k8s/argo-workflow%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%88%86%E6%9E%90/>Argo Workflow性能测试和使用场景分析</a></li><li><a href=/docs/programmer/cloudnative/k8s/argo-%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/>Argo 使用记录</a></li></ul></li><li><input type=checkbox id=section-b828bf3d116bc282da9db25a06bf908e class=toggle>
<label for=section-b828bf3d116bc282da9db25a06bf908e class="flex justify-between"><a role=button>中间件</a></label><ul><li><a href=/docs/programmer/cloudnative/middleware/kafka-%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/>Kafka 安装和使用</a></li></ul></li><li><a href=/docs/programmer/cloudnative/%E5%AE%B9%E5%99%A8/note-of-podman/>Podman</a></li><li><a href=/docs/programmer/cloudnative/nginx%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE/>Nginx实用配置</a></li><li><a href=/docs/programmer/cloudnative/uwsgi-%E5%A4%84%E7%90%86%E8%AE%B0%E5%BD%95/>uwsgi 处理记录</a></li><li><a href=/docs/programmer/cloudnative/note-of-docker/>Docker</a></li><li><a href=/docs/programmer/cloudnative/%E5%AE%B9%E5%99%A8/note-of-docker/>Docker</a></li><li><a href=/docs/programmer/cloudnative/fastapi/>Django的建站的(｡･･)ﾉﾞ</a></li><li><a href=/docs/programmer/cloudnative/nginx-%E9%AB%98%E5%8F%AF%E7%94%A8/>Nginx高可用</a></li><li><a href=/docs/programmer/cloudnative/notesdjango/>Django的建站的(｡･･)ﾉﾞ</a></li><li><a href=/docs/programmer/cloudnative/sonar-%E4%BB%A3%E7%A0%81%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5/>Sonar 代码静态检查</a></li></ul></li><li><input type=checkbox id=section-883e27361d38e16afb68faff3435ac0b class=toggle>
<label for=section-883e27361d38e16afb68faff3435ac0b class="flex justify-between"><a role=button>机器学习</a></label><ul><li><a href=/docs/programmer/ml/stable-diffusion/>AI画图</a></li><li><a href=/docs/programmer/ml/%E7%88%AC%E8%99%AB/>爬虫</a></li><li><a href=/docs/programmer/ml/paddle/>Paddle</a></li><li><a href=/docs/programmer/ml/tensorflow/>Tensorflow</a></li><li><a href=/docs/programmer/ml/opencv/>OpenCV</a></li><li><a href=/docs/programmer/ml/yolo/>Demo Test项目中的一些东西</a></li><li><a href=/docs/programmer/ml/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B8%B8%E7%94%A8%E5%BA%93%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/>机器学习库</a></li></ul></li><li><input type=checkbox id=section-0bf4f4329214e20fa67ca3e12c6aad0c class=toggle>
<label for=section-0bf4f4329214e20fa67ca3e12c6aad0c class="flex justify-between"><a role=button>平台</a></label><ul><li><a href=/docs/programmer/platforms/ubuntu/>Ubuntu</a></li><li><a href=/docs/programmer/platforms/%E9%98%BF%E9%87%8C%E4%BA%91%E4%BD%BF%E7%94%A8/>阿里云使用</a></li><li><a href=/docs/programmer/platforms/wps-for-linux/>WPS for Linux</a></li><li><a href=/docs/programmer/platforms/appsflyer/>AppsFlyer-外网移动归因营销分析平台</a></li></ul></li><li><input type=checkbox id=section-bf4e0d6f0b81f7b3ec08ed1fc66b874d class=toggle checked>
<label for=section-bf4e0d6f0b81f7b3ec08ed1fc66b874d class="flex justify-between"><a href=/docs/programmer/langs/>编程语言</a></label><ul><li><input type=checkbox id=section-771df6c720301e69f1715f7fc174ac3d class=toggle checked>
<label for=section-771df6c720301e69f1715f7fc174ac3d class="flex justify-between"><a role=button>Python</a></label><ul><li><a href=/docs/programmer/langs/python/sqlalchemy/>SqlAlchemy - 数据库Orm</a></li><li><a href=/docs/programmer/langs/python/pypi/>PyPi使用说明</a></li><li><a href=/docs/programmer/langs/python/pytest/>PyTest</a></li><li><a href=/docs/programmer/langs/python/paramiko-%E4%BD%BF%E7%94%A8-sshsftp/>Paramiko 使用 Ssh&amp;sftp</a></li><li><a href=/docs/programmer/langs/python/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%9A%E8%BF%9B%E7%A8%8B/>Python 多线程多进程</a></li><li><a href=/docs/programmer/langs/python/notespython/>Python 常用库</a></li><li><a href=/docs/programmer/langs/python/notespython/>Python 笔记</a></li><li><a href=/docs/programmer/langs/python/py%E5%B0%8F%E5%B7%A5%E5%85%B7%E5%92%8C%E5%8A%9F%E8%83%BD%E6%80%A7%E6%96%B9%E6%B3%95/ class=active>Py小工具和功能性方法</a></li><li><a href=/docs/programmer/langs/python/notespython/>解决问题</a></li></ul></li><li><input type=checkbox id=section-9f8ac8f06e138c7ac13ff61f23b4d497 class=toggle>
<label for=section-9f8ac8f06e138c7ac13ff61f23b4d497 class="flex justify-between"><a role=button>Golang</a></label><ul><li><a href=/docs/programmer/langs/golang/advanced-knowledge-of-golang/>Golang进阶笔记</a></li><li><a href=/docs/programmer/langs/golang/noteofgoexp/>Golang进阶笔记</a></li><li><a href=/docs/programmer/langs/golang/note-of-golang/>Golang笔记</a></li><li><a href=/docs/programmer/langs/golang/noteofgolang/>Golang笔记</a></li></ul></li><li><a href=/docs/programmer/langs/cmake/>CMake 使用Tips</a></li><li><a href=/docs/programmer/langs/tips-of-debugers/>Tips of debuggers</a></li><li><a href=/docs/programmer/langs/tips-of-markdown/>Tips of MarkDown</a></li><li><a href=/docs/programmer/langs/java/notesjava/>愉快的Java(happy to learn the fuck java)</a></li><li><a href=/docs/programmer/langs/note-for-fmtdata/>数据格式笔记</a></li></ul></li><li><input type=checkbox id=section-de7bfad1d124522974cdf8addfbb23f2 class=toggle>
<label for=section-de7bfad1d124522974cdf8addfbb23f2 class="flex justify-between"><a role=button>Net</a></label><ul><li><a href=/docs/programmer/net/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/>网络编程</a></li><li><a href=/docs/programmer/net/nginx%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE/>Nginx实用配置</a></li><li><a href=/docs/programmer/net/tips-of-grpc/>gRpc使用小记</a></li><li><a href=/docs/programmer/net/epoll%E5%AE%9E%E7%8E%B0/>Epoll实现</a></li><li><a href=/docs/programmer/net/net/>Epoll实现</a></li></ul></li><li><input type=checkbox id=section-4446dd07527142b855f26d7cc8f0e617 class=toggle>
<label for=section-4446dd07527142b855f26d7cc8f0e617 class="flex justify-between"><a href=/docs/programmer/database/>Database</a></label><ul><li><a href=/docs/programmer/database/mongodb/>Mongodb使用记录</a></li><li><a href=/docs/programmer/database/dgraph/>Dgraph使用小记</a></li><li><a href=/docs/programmer/database/note-of-db-data-mongodb/>数据库-MongoDB篇</a></li><li><a href=/docs/programmer/database/note-of-db-data/>数据库-MongoDB篇</a></li><li><a href=/docs/programmer/database/note-of-db-data-mysql/>数据库-MySQL篇</a></li></ul></li><li><input type=checkbox id=section-7e5360c5e7954906b897ed79085884b6 class=toggle>
<label for=section-7e5360c5e7954906b897ed79085884b6 class="flex justify-between"><a href=/docs/programmer/gui/>图形用户界面-GUI</a></label><ul><li><a href=/docs/programmer/gui/pyinstaller-python%E6%89%93%E5%8C%85/>python打包</a></li><li><a href=/docs/programmer/gui/pyinstaller/>python打包</a></li><li><a href=/docs/programmer/gui/qt/>Qt/PySide</a></li><li><a href=/docs/programmer/gui/noteofvn_py/>Vn.Py学习笔记（Python交易平台框架）</a></li><li><a href=/docs/programmer/gui/vn.py%E7%AC%94%E8%AE%B0-%E4%BA%A4%E6%98%93%E5%B9%B3%E5%8F%B0%E5%AE%A2%E6%88%B7%E7%AB%AF/>Vn.Py学习笔记（Python交易平台框架）</a></li><li><a href=/docs/programmer/gui/notespython/>图形化界面 （Python Gui）</a></li><li><a href=/docs/programmer/gui/notespython/>图形化界面 （Python Gui）</a></li></ul></li><li><input type=checkbox id=section-ddcbe632dc99a9fb372422dada8ee641 class=toggle>
<label for=section-ddcbe632dc99a9fb372422dada8ee641 class="flex justify-between"><a role=button>OS操作系统问题处理</a></label><ul><li><a href=/docs/programmer/os/install_some/>安装问题</a></li><li><a href=/docs/programmer/os/android/>安卓</a></li><li><a href=/docs/programmer/os/freebsd/>FreeBSD</a></li><li><a href=/docs/programmer/os/note-of-linux/>Linux 笔记</a></li><li><a href=/docs/programmer/os/npm/>Npm</a></li><li><a href=/docs/programmer/os/git/>Git</a></li><li><a href=/docs/programmer/os/problem-of-windows/>Windows 爬坑记</a></li><li><a href=/docs/programmer/os/tips-of-problems/>解决问题记录笔记</a></li></ul></li><li><input type=checkbox id=section-d325c59fc6513e1b1e05a60b192d4973 class=toggle>
<label for=section-d325c59fc6513e1b1e05a60b192d4973 class="flex justify-between"><a href=/docs/programmer/hardware/>硬件</a></label><ul><li><a href=/docs/programmer/hardware/raspberrypi/>Raspberry Pi</a></li><li><a href=/docs/programmer/hardware/screen/>Screen</a></li></ul></li></ul></li><li class=book-section-flat><span>建模和游戏</span><ul><li><a href=/docs/3dgame/blender/>Blender</a></li><li><a href=/docs/3dgame/noteofue4/>UE4 笔记</a></li></ul></li><li class=book-section-flat><a href=/docs/example/>Hugo特殊Markdown语法说明</a><ul><li><a href=/docs/example/table-of-contents/>Table of Contents</a><ul><li><a href=/docs/example/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/example/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><a href=/docs/example/shortcodes/buttons/>Buttons</a></li><li><a href=/docs/example/shortcodes/columns/>Columns</a></li><li><a href=/docs/example/shortcodes/details/>Details</a></li><li><a href=/docs/example/shortcodes/expand/>Expand</a></li><li><a href=/docs/example/shortcodes/hints/>Hints</a></li><li><a href=/docs/example/shortcodes/tabs/>Tabs</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Py小工具和功能性方法</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><p>author:Ian</p><p><img src=https://www.python.org/static/img/python-logo@2x.png alt=python></p><h1 id=邮件>邮件
<a class=anchor href=#%e9%82%ae%e4%bb%b6>#</a></h1><blockquote><p>发送邮件时携带附件 中文名称附件</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send_email_week_report</span>(htm, recipients, copys, file_name, file_path):
</span></span><span style=display:flex><span>    port <span style=color:#f92672>=</span> <span style=color:#ae81ff>465</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># str_today = datetime.now().strftime(&#34;%Y-%m-%d %H:%M:%S&#34;)</span>
</span></span><span style=display:flex><span>    str_today <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    mail_host <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;mail.</span><span style=color:#e6db74>{demo}</span><span style=color:#e6db74>.com&#34;</span>
</span></span><span style=display:flex><span>    mail_user <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;{user name}&#34;</span>
</span></span><span style=display:flex><span>    mail_pass <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{passwd}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    sender <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{name}</span><span style=color:#e6db74>@</span><span style=color:#e6db74>{demo}</span><span style=color:#e6db74>.com&#39;</span>
</span></span><span style=display:flex><span>    mail_from <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{name}</span><span style=color:#e6db74> &lt;</span><span style=color:#e6db74>{name}</span><span style=color:#e6db74>@</span><span style=color:#e6db74>{demo}</span><span style=color:#e6db74>.com&gt;&#34;</span>
</span></span><span style=display:flex><span>    msg_Bcc <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{name}</span><span style=color:#e6db74>@</span><span style=color:#e6db74>{demo}</span><span style=color:#e6db74>.com&#39;</span>
</span></span><span style=display:flex><span>    subject <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>title<span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>{</span>str_today<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>  <span style=color:#75715e># 标题</span>
</span></span><span style=display:flex><span>    msg <span style=color:#f92672>=</span> MIMEMultipart()
</span></span><span style=display:flex><span>    msg<span style=color:#f92672>.</span>attach(MIMEText(htm, <span style=color:#e6db74>&#39;html&#39;</span>, <span style=color:#e6db74>&#39;utf-8&#39;</span>))  <span style=color:#75715e># 这里可以传html内容 也可以传普通文字</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 创建附件</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(file_path, <span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> attachment:
</span></span><span style=display:flex><span>        part <span style=color:#f92672>=</span> MIMEBase(<span style=color:#e6db74>&#39;application&#39;</span>, <span style=color:#e6db74>&#39;octet-stream&#39;</span>)
</span></span><span style=display:flex><span>        part<span style=color:#f92672>.</span>set_payload(attachment<span style=color:#f92672>.</span>read())
</span></span><span style=display:flex><span>        encoders<span style=color:#f92672>.</span>encode_base64(part)
</span></span><span style=display:flex><span>        part<span style=color:#f92672>.</span>add_header(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;Content-Disposition&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;attachment&#39;</span>,
</span></span><span style=display:flex><span>            filename<span style=color:#f92672>=</span>(<span style=color:#e6db74>&#34;utf-8&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, file_name),
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        msg<span style=color:#f92672>.</span>attach(part)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> root, _, files <span style=color:#f92672>in</span> os<span style=color:#f92672>.</span>walk(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(BASE_DIR, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{path}</span><span style=color:#e6db74>/images&#39;</span>)):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> files:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> f <span style=color:#f92672>in</span> htm:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>with</span> open(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(root, f), <span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> fp:
</span></span><span style=display:flex><span>                    image <span style=color:#f92672>=</span> MIMEImage(fp<span style=color:#f92672>.</span>read())
</span></span><span style=display:flex><span>                    image<span style=color:#f92672>.</span>add_header(<span style=color:#e6db74>&#39;Content-ID&#39;</span>, <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;&lt;</span><span style=color:#e6db74>{</span>f<span style=color:#e6db74>}</span><span style=color:#e6db74>&gt;&#39;</span>)
</span></span><span style=display:flex><span>                    msg<span style=color:#f92672>.</span>attach(image)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    msg[<span style=color:#e6db74>&#39;From&#39;</span>] <span style=color:#f92672>=</span> mail_from  <span style=color:#75715e># 发件人</span>
</span></span><span style=display:flex><span>    msg[<span style=color:#e6db74>&#39;To&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;;&#34;</span><span style=color:#f92672>.</span>join(recipients)  <span style=color:#75715e># 收件人多个逗号分隔</span>
</span></span><span style=display:flex><span>    msg[<span style=color:#e6db74>&#34;Cc&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;;&#34;</span><span style=color:#f92672>.</span>join(copys)
</span></span><span style=display:flex><span>    msg[<span style=color:#e6db74>&#34;Bcc&#34;</span>] <span style=color:#f92672>=</span> msg_Bcc
</span></span><span style=display:flex><span>    subject <span style=color:#f92672>=</span> subject
</span></span><span style=display:flex><span>    msg[<span style=color:#e6db74>&#39;Subject&#39;</span>] <span style=color:#f92672>=</span> Header(subject)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        smtpObj <span style=color:#f92672>=</span> smtplib<span style=color:#f92672>.</span>SMTP_SSL(mail_host)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> is_partner_node <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            smtpObj <span style=color:#f92672>=</span> smtplib<span style=color:#f92672>.</span>SMTP(mail_host)
</span></span><span style=display:flex><span>        smtpObj<span style=color:#f92672>.</span>connect(mail_host, port)
</span></span><span style=display:flex><span>        smtpObj<span style=color:#f92672>.</span>login(mail_user, mail_pass)
</span></span><span style=display:flex><span>        smtpObj<span style=color:#f92672>.</span>sendmail(sender, recipients <span style=color:#f92672>+</span> copys <span style=color:#f92672>+</span> [sender], msg<span style=color:#f92672>.</span>as_string())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> smtplib<span style=color:#f92672>.</span>SMTPException <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span></code></pre></div><blockquote><p>这种内容插入附件会有文件名称长度限制(19好像或者16)</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 创建附件</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(file_path, <span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> attachment:
</span></span><span style=display:flex><span>    part <span style=color:#f92672>=</span> MIMEBase(<span style=color:#e6db74>&#39;application&#39;</span>, <span style=color:#e6db74>&#39;octet-stream&#39;</span>)
</span></span><span style=display:flex><span>    part<span style=color:#f92672>.</span>set_payload(attachment<span style=color:#f92672>.</span>read())
</span></span><span style=display:flex><span>    encoders<span style=color:#f92672>.</span>encode_base64(part)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(file_name) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>18</span>:
</span></span><span style=display:flex><span>        file_name <span style=color:#f92672>=</span> file_name[:<span style=color:#ae81ff>9</span>] <span style=color:#f92672>+</span> file_name[<span style=color:#f92672>-</span><span style=color:#ae81ff>9</span>:]
</span></span><span style=display:flex><span>    part<span style=color:#f92672>.</span>add_header(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Content-Disposition&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;attachment; filename=</span><span style=color:#e6db74>{</span>Header(file_name, <span style=color:#e6db74>&#34;utf-8&#34;</span>)<span style=color:#f92672>.</span>encode()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    msg<span style=color:#f92672>.</span>attach(part)
</span></span></code></pre></div><h1 id=docx-插入附件-插入文件>docx 插入附件 插入文件
<a class=anchor href=#docx-%e6%8f%92%e5%85%a5%e9%99%84%e4%bb%b6-%e6%8f%92%e5%85%a5%e6%96%87%e4%bb%b6>#</a></h1><blockquote><p>取巧的办法 通过替换文件实现插入</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>__name__: main.py
</span></span></span><span style=display:flex><span><span style=color:#e6db74>替换掉word模板中的excel文件内容
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>所需文件:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - demo.docx(其中已经插入了一个xlsx文件)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - demo_aim.xlsx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> shutil
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> zipfile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DocxEmbeddingFile</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, src_docx_fn, temp_path, extract_folder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;extrated&#39;</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>src_docx_fn <span style=color:#f92672>=</span> src_docx_fn
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>temp_path <span style=color:#f92672>=</span> temp_path
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>extract_folder <span style=color:#f92672>=</span> extract_folder
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>unzip_docx</span>(self):
</span></span><span style=display:flex><span>        shutil<span style=color:#f92672>.</span>rmtree(self<span style=color:#f92672>.</span>extract_folder, ignore_errors<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>mkdir(self<span style=color:#f92672>.</span>extract_folder)
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>chdir(self<span style=color:#f92672>.</span>extract_folder)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> zipfile<span style=color:#f92672>.</span>ZipFile(self<span style=color:#f92672>.</span>src_docx_fn) <span style=color:#66d9ef>as</span> azip:
</span></span><span style=display:flex><span>            azip<span style=color:#f92672>.</span>extractall()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>change_ip_details_xlsx</span>(self, path):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;# 第一个插入的文件命名规则为按插入顺序递增:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - Microsoft_Excel_Worksheet.xlsx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - Microsoft_Excel_Worksheet1.xlsx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - Microsoft_Word_Document.docx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        如果要测试其他类型文件,可将docx解压后去以下路径去查看
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        shutil<span style=color:#f92672>.</span>copy(path, os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>temp_path, self<span style=color:#f92672>.</span>extract_folder, <span style=color:#e6db74>&#34;word&#34;</span>, <span style=color:#e6db74>&#34;embeddings&#34;</span>, <span style=color:#e6db74>&#34;Microsoft_Excel_Worksheet.xlsx&#34;</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>zip_docx</span>(self):
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>chdir(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>temp_path, self<span style=color:#f92672>.</span>extract_folder))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> zipfile<span style=color:#f92672>.</span>ZipFile(self<span style=color:#f92672>.</span>src_docx_fn, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> azip:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> os<span style=color:#f92672>.</span>walk(<span style=color:#e6db74>&#39;.&#39;</span>):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> i[<span style=color:#ae81ff>2</span>]:
</span></span><span style=display:flex><span>                    azip<span style=color:#f92672>.</span>write(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(i[<span style=color:#ae81ff>0</span>], j), compress_type<span style=color:#f92672>=</span>zipfile<span style=color:#f92672>.</span>ZIP_DEFLATED)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    temp_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>dirname(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>abspath(__file__))
</span></span><span style=display:flex><span>    report_path <span style=color:#f92672>=</span> temp_path
</span></span><span style=display:flex><span>    src_docx_fn <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(report_path, <span style=color:#e6db74>&#34;demo.docx&#34;</span>)
</span></span><span style=display:flex><span>    docxef <span style=color:#f92672>=</span> DocxEmbeddingFile(src_docx_fn<span style=color:#f92672>=</span>src_docx_fn, temp_path<span style=color:#f92672>=</span>temp_path)
</span></span><span style=display:flex><span>    docxef<span style=color:#f92672>.</span>unzip_docx()
</span></span><span style=display:flex><span>    docxef<span style=color:#f92672>.</span>change_ip_details_xlsx(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(temp_path, <span style=color:#e6db74>&#34;demo_aim.xlsx&#34;</span>))
</span></span><span style=display:flex><span>    docxef<span style=color:#f92672>.</span>zip_docx()
</span></span></code></pre></div><h1 id=word-插入文件附件>word 插入文件附件
<a class=anchor href=#word-%e6%8f%92%e5%85%a5%e6%96%87%e4%bb%b6%e9%99%84%e4%bb%b6>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DocxEmbeddingFile</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, src_docx_fn, temp_path, extract_folder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;extrated&#39;</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>src_docx_fn <span style=color:#f92672>=</span> src_docx_fn
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>temp_path <span style=color:#f92672>=</span> temp_path
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>extract_folder <span style=color:#f92672>=</span> extract_folder
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>unzip_docx</span>(self):
</span></span><span style=display:flex><span>        original_dir <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>getcwd()
</span></span><span style=display:flex><span>        shutil<span style=color:#f92672>.</span>rmtree(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>temp_path, self<span style=color:#f92672>.</span>extract_folder), ignore_errors<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>mkdir(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>temp_path, self<span style=color:#f92672>.</span>extract_folder))
</span></span><span style=display:flex><span>        dir_path, file_name <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>split(self<span style=color:#f92672>.</span>src_docx_fn)
</span></span><span style=display:flex><span>        docx_file_path <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>src_docx_fn
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> file_name<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#34;.zip&#34;</span>):
</span></span><span style=display:flex><span>            os<span style=color:#f92672>.</span>chdir(self<span style=color:#f92672>.</span>temp_path)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>with</span> zipfile<span style=color:#f92672>.</span>ZipFile(self<span style=color:#f92672>.</span>src_docx_fn) <span style=color:#66d9ef>as</span> azip:
</span></span><span style=display:flex><span>                azip<span style=color:#f92672>.</span>extractall()
</span></span><span style=display:flex><span>            file_name <span style=color:#f92672>=</span> file_name<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;zip&#34;</span>, <span style=color:#e6db74>&#34;docx&#34;</span>)
</span></span><span style=display:flex><span>            docx_file_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(dir_path, file_name)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> file_name<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#34;docx&#34;</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            os<span style=color:#f92672>.</span>chdir(original_dir)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>chdir(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>temp_path, self<span style=color:#f92672>.</span>extract_folder))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> zipfile<span style=color:#f92672>.</span>ZipFile(docx_file_path) <span style=color:#66d9ef>as</span> azip:
</span></span><span style=display:flex><span>            azip<span style=color:#f92672>.</span>extractall()
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>chdir(original_dir)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>change_ip_details_xlsx</span>(self, path):
</span></span><span style=display:flex><span>	    <span style=color:#75715e># 通过替换文件实现文件插入</span>
</span></span><span style=display:flex><span>        target_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>temp_path, self<span style=color:#f92672>.</span>extract_folder, <span style=color:#e6db74>&#34;word&#34;</span>, <span style=color:#e6db74>&#34;embeddings&#34;</span>, <span style=color:#e6db74>&#34;Microsoft_Excel_Worksheet.xlsx&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> path <span style=color:#f92672>or</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(target_path):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        shutil<span style=color:#f92672>.</span>copy(path, target_path)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>zip_docx</span>(self):
</span></span><span style=display:flex><span>        original_dir <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>getcwd()
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>chdir(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>temp_path, self<span style=color:#f92672>.</span>extract_folder))
</span></span><span style=display:flex><span>        docx_file_path <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>src_docx_fn
</span></span><span style=display:flex><span>        dir_path, file_name <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>split(self<span style=color:#f92672>.</span>src_docx_fn)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> file_name<span style=color:#f92672>.</span>endswith(<span style=color:#e6db74>&#34;.zip&#34;</span>):
</span></span><span style=display:flex><span>            file_name <span style=color:#f92672>=</span> file_name<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;zip&#34;</span>, <span style=color:#e6db74>&#34;docx&#34;</span>)
</span></span><span style=display:flex><span>            docx_file_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(dir_path, file_name)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> zipfile<span style=color:#f92672>.</span>ZipFile(docx_file_path, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> azip:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> os<span style=color:#f92672>.</span>walk(<span style=color:#e6db74>&#39;.&#39;</span>):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> i[<span style=color:#ae81ff>2</span>]:
</span></span><span style=display:flex><span>                    azip<span style=color:#f92672>.</span>write(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(i[<span style=color:#ae81ff>0</span>], j), compress_type<span style=color:#f92672>=</span>zipfile<span style=color:#f92672>.</span>ZIP_DEFLATED)
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>chdir(original_dir)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> docx_file_path
</span></span></code></pre></div><h1 id=生成excel文件>生成Excel文件
<a class=anchor href=#%e7%94%9f%e6%88%90excel%e6%96%87%e4%bb%b6>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SheetGenerater</span>:
</span></span><span style=display:flex><span>    t_risky_info <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1_2&#34;</span>
</span></span><span style=display:flex><span>    t_failed_info <span style=color:#f92672>=</span> <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;key1信息&#34;</span>
</span></span><span style=display:flex><span>    t_simple <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;simple&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, key, title, _type, sheeter):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>key <span style=color:#f92672>=</span> key
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> title
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>type <span style=color:#f92672>=</span> _type
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sheeter <span style=color:#f92672>=</span> sheeter
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>dict_title <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;key1信息&#34;</span>: [<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;本周期内第三列明细如下：&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;本周期内第三列告警详情如下：&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;key2信息&#34;</span>: [<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;本周期内风险主机明细如下：&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;详情&#34;</span>]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__get_list_dict_value</span>(self, n, key, data):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>&lt;=</span> n:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>        value <span style=color:#f92672>=</span> data[n][key]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> isinstance(value, str) <span style=color:#f92672>or</span> isinstance(value, unicode):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> value <span style=color:#f92672>and</span> (isinstance(value, list) <span style=color:#f92672>or</span> isinstance(value, tuple)) <span style=color:#f92672>and</span> (isinstance(value[<span style=color:#ae81ff>0</span>], str) <span style=color:#f92672>or</span> isinstance(value[<span style=color:#ae81ff>0</span>], unicode)):
</span></span><span style=display:flex><span>            value <span style=color:#f92672>=</span> <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;,&#39;</span><span style=color:#f92672>.</span>join(value)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            value <span style=color:#f92672>=</span> str(value)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> value
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>full_sheet_data_failed</span>(self, sheet_data):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        key1信息 sheet信息填充
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        实现方式与数据长度强相关，如果需要向表格中添加数据，需要手动调整各个数值
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># set column names for sheet1 and fill in data</span>
</span></span><span style=display:flex><span>        col_names <span style=color:#f92672>=</span> [<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;序号&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;第三列&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;第四列&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;备注&#34;</span>]
</span></span><span style=display:flex><span>        col_names_2 <span style=color:#f92672>=</span> [<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;序号&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;告警时间&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;事件名称&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;源IP&#34;</span>, <span style=color:#e6db74>&#34;目的IP&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>dict_title<span style=color:#f92672>.</span>get(self<span style=color:#f92672>.</span>title):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>merge_cells(<span style=color:#e6db74>&#39;A1:D1&#39;</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>value <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>dict_title[self<span style=color:#f92672>.</span>title][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>fill <span style=color:#f92672>=</span> PatternFill(start_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;00b050&#39;</span>, end_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;00b050&#39;</span>, fill_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;solid&#39;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>merge_cells(<span style=color:#e6db74>&#39;F1:J1&#39;</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span><span style=color:#f92672>+</span>len(col_names))<span style=color:#f92672>.</span>value <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>dict_title[self<span style=color:#f92672>.</span>title][<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span><span style=color:#f92672>+</span>len(col_names))<span style=color:#f92672>.</span>fill <span style=color:#f92672>=</span> PatternFill(start_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;00b050&#39;</span>, end_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;00b050&#39;</span>, fill_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;solid&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>append(col_names <span style=color:#f92672>+</span> [<span style=color:#e6db74>&#34;&#34;</span>] <span style=color:#f92672>+</span> col_names_2)
</span></span><span style=display:flex><span>        <span style=color:#75715e># self.sheeter.append([u&#34;序号&#34;, u&#34;状态&#34;, u&#34;第三列&#34;, u&#34;第四列&#34;, u&#34;备注&#34;])</span>
</span></span><span style=display:flex><span>        longer <span style=color:#f92672>=</span> sheet_data[<span style=color:#e6db74>&#34;key1&#34;</span>] <span style=color:#66d9ef>if</span> len(sheet_data[<span style=color:#e6db74>&#34;key1&#34;</span>]) <span style=color:#f92672>&gt;</span> len(sheet_data[<span style=color:#e6db74>&#34;failed_host_warning_info&#34;</span>]) <span style=color:#66d9ef>else</span> sheet_data[<span style=color:#e6db74>&#34;failed_host_warning_info&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> n, _ <span style=color:#f92672>in</span> enumerate(longer):
</span></span><span style=display:flex><span>            <span style=color:#75715e># item[&#34;loop_state&#34;] # 状态列,暂时不做自动填充,此列直接删除</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>append([
</span></span><span style=display:flex><span>                str(n<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;host&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;key1&#34;</span>]) <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;host&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;key1&#34;</span>]),
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;event&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;key1&#34;</span>]),
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;remark&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;key1&#34;</span>]),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>                str(n<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;datetime&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;failed_host_warning_info&#34;</span>]) <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;datetime&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;failed_host_warning_info&#34;</span>]),
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;event&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;failed_host_warning_info&#34;</span>]),
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;source_ip&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;failed_host_warning_info&#34;</span>]),
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;destined_ip&#34;</span>, sheet_data[<span style=color:#e6db74>&#34;failed_host_warning_info&#34;</span>]),
</span></span><span style=display:flex><span>            ])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> n, cell <span style=color:#f92672>in</span> enumerate(self<span style=color:#f92672>.</span>sheeter[<span style=color:#ae81ff>2</span>]):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> n <span style=color:#f92672>==</span> len(col_names):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            cell<span style=color:#f92672>.</span>fill <span style=color:#f92672>=</span> openpyxl<span style=color:#f92672>.</span>styles<span style=color:#f92672>.</span>PatternFill(start_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;92D050&#34;</span>, end_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;92D050&#34;</span>, fill_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;solid&#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>autosize_table()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>full_sheet_data_risky</span>(self, sheet_data):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        key2信息 sheet信息填充
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># set column names for sheet1 and fill in data</span>
</span></span><span style=display:flex><span>        col_names <span style=color:#f92672>=</span> [<span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;序号&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;风险主机&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;第四列&#34;</span>, <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;备注&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>dict_title<span style=color:#f92672>.</span>get(self<span style=color:#f92672>.</span>title):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>merge_cells(start_row<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, start_column<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, end_row<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, end_column<span style=color:#f92672>=</span>len(col_names))
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(row<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, column<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, value<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>dict_title[self<span style=color:#f92672>.</span>title][<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>            fill <span style=color:#f92672>=</span> PatternFill(fill_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;solid&#39;</span>, fgColor<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;00b050&#34;</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(row<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, column<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>fill <span style=color:#f92672>=</span> fill
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(row<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, column<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>alignment <span style=color:#f92672>=</span> Alignment(horizontal<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;center&#39;</span>, vertical<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;center&#39;</span>, wrap_text<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>dict_title<span style=color:#f92672>.</span>get(self<span style=color:#f92672>.</span>title):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>merge_cells(<span style=color:#e6db74>&#39;A1:D1&#39;</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>value <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>dict_title[self<span style=color:#f92672>.</span>title][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>fill <span style=color:#f92672>=</span> PatternFill(start_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;00b050&#39;</span>, end_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;00b050&#39;</span>, fill_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;solid&#39;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e># self.sheeter.merge_cells(&#39;F1:J1&#39;)</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span><span style=color:#f92672>+</span>len(col_names))<span style=color:#f92672>.</span>value <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>dict_title[self<span style=color:#f92672>.</span>title][<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>cell(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span><span style=color:#f92672>+</span>len(col_names))<span style=color:#f92672>.</span>fill <span style=color:#f92672>=</span> PatternFill(start_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;00b050&#39;</span>, end_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;00b050&#39;</span>, fill_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;solid&#39;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>append(col_names)
</span></span><span style=display:flex><span>        <span style=color:#75715e># self.sheeter.append([u&#34;序号&#34;, u&#34;状态&#34;, u&#34;第三列&#34;, u&#34;第四列&#34;, u&#34;备注&#34;])</span>
</span></span><span style=display:flex><span>        sheet_data <span style=color:#f92672>=</span> sheet_data[<span style=color:#e6db74>&#34;key2&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> n, _ <span style=color:#f92672>in</span> enumerate(sheet_data):
</span></span><span style=display:flex><span>            <span style=color:#75715e># item[&#34;loop_state&#34;] # 状态列,暂时不做自动填充,此列直接删除</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># self.sheeter.append([str(n+1), item[&#34;host&#34;], item[&#34;event&#34;], item[&#34;remark&#34;]])</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>append([str(n<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;host&#34;</span>, sheet_data),
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;event&#34;</span>, sheet_data),
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>__get_list_dict_value(n, <span style=color:#e6db74>&#34;remark&#34;</span>, sheet_data)
</span></span><span style=display:flex><span>            ])
</span></span><span style=display:flex><span>            <span style=color:#75715e># set background color for column headers</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> n, cell <span style=color:#f92672>in</span> enumerate(self<span style=color:#f92672>.</span>sheeter[<span style=color:#ae81ff>2</span>]):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> n <span style=color:#f92672>==</span> len(col_names):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>            cell<span style=color:#f92672>.</span>fill <span style=color:#f92672>=</span> openpyxl<span style=color:#f92672>.</span>styles<span style=color:#f92672>.</span>PatternFill(start_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;92D050&#34;</span>, end_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;92D050&#34;</span>, fill_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;solid&#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>autosize_table()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>full_sheet_data_simple</span>(self, sheet_data):
</span></span><span style=display:flex><span>        <span style=color:#75715e># set column names and fill in data for sheet3</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>append(sheet_data[<span style=color:#e6db74>&#34;column_name&#34;</span>])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> row <span style=color:#f92672>in</span> sheet_data[<span style=color:#e6db74>&#34;table&#34;</span>]:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>append(row)
</span></span><span style=display:flex><span>            <span style=color:#75715e># set background color for column headers</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> cell <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>sheeter[<span style=color:#ae81ff>1</span>]:
</span></span><span style=display:flex><span>            cell<span style=color:#f92672>.</span>fill <span style=color:#f92672>=</span> openpyxl<span style=color:#f92672>.</span>styles<span style=color:#f92672>.</span>PatternFill(start_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;92D050&#34;</span>, end_color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;92D050&#34;</span>, fill_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;solid&#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>autosize_table()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>autosize_table</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 生效了</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>column_dimensions[<span style=color:#e6db74>&#39;B&#39;</span>]<span style=color:#f92672>.</span>width <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>title <span style=color:#f92672>==</span> <span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;key3信息&#34;</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>column_dimensions[<span style=color:#e6db74>&#39;C&#39;</span>]<span style=color:#f92672>.</span>width <span style=color:#f92672>=</span> <span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sheeter<span style=color:#f92672>.</span>column_dimensions[<span style=color:#e6db74>&#39;C&#39;</span>]<span style=color:#f92672>.</span>width <span style=color:#f92672>=</span> <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># for column in self.sheeter.columns:</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#     column_letter = get_column_letter(column[0].column)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#     self.sheeter.column_dimensions[column_letter].auto_size = True</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># self.sheeter.column_dimensions[column_letter].max_width = 500</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>full_sheet</span>(self, data):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>type <span style=color:#f92672>==</span> SheetGenerater<span style=color:#f92672>.</span>t_risky_info:
</span></span><span style=display:flex><span>            <span style=color:#75715e># print(&#39;excel_utils -------135 {}&#39;.format(data))</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>full_sheet_data_risky(data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>type <span style=color:#f92672>==</span> SheetGenerater<span style=color:#f92672>.</span>t_failed_info:
</span></span><span style=display:flex><span>            <span style=color:#75715e># print(&#39;excel_utils -------138 {}&#39;.format(data))</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>full_sheet_data_failed(data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> self<span style=color:#f92672>.</span>type <span style=color:#f92672>==</span> SheetGenerater<span style=color:#f92672>.</span>t_simple:
</span></span><span style=display:flex><span>            <span style=color:#75715e># print(&#39;excel_utils -------141 {}&#39;.format(data))</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>full_sheet_data_simple(data)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_excel</span>(data, output_path):
</span></span><span style=display:flex><span>    <span style=color:#75715e># create new workbook and worksheets</span>
</span></span><span style=display:flex><span>    workbook <span style=color:#f92672>=</span> openpyxl<span style=color:#f92672>.</span>Workbook()
</span></span><span style=display:flex><span>    sheet1 <span style=color:#f92672>=</span> workbook<span style=color:#f92672>.</span>active
</span></span><span style=display:flex><span>    sheet_gennerater_list <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        SheetGenerater(key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;key1&#34;</span>, title<span style=color:#f92672>=</span><span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;key1信息&#34;</span>, _type<span style=color:#f92672>=</span>SheetGenerater<span style=color:#f92672>.</span>t_failed_info, sheeter<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>        SheetGenerater(key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;key2&#34;</span>, title<span style=color:#f92672>=</span><span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;key2信息&#34;</span>, _type<span style=color:#f92672>=</span>SheetGenerater<span style=color:#f92672>.</span>t_risky_info, sheeter<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>        SheetGenerater(key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;key3&#34;</span>, title<span style=color:#f92672>=</span><span style=color:#e6db74>u</span><span style=color:#e6db74>&#34;key3信息&#34;</span>, _type<span style=color:#f92672>=</span>SheetGenerater<span style=color:#f92672>.</span>t_simple, sheeter<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> n, sheet_gennerater <span style=color:#f92672>in</span> enumerate(sheet_gennerater_list):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> data<span style=color:#f92672>.</span>get(sheet_gennerater<span style=color:#f92672>.</span>key) <span style=color:#f92672>and</span> sheet1<span style=color:#f92672>.</span>title <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Sheet&#34;</span>:
</span></span><span style=display:flex><span>            sheet1<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> sheet_gennerater<span style=color:#f92672>.</span>title
</span></span><span style=display:flex><span>            sheet_gennerater_list[n]<span style=color:#f92672>.</span>sheeter <span style=color:#f92672>=</span> sheet1
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> data<span style=color:#f92672>.</span>get(sheet_gennerater<span style=color:#f92672>.</span>key):
</span></span><span style=display:flex><span>            _sheet <span style=color:#f92672>=</span> workbook<span style=color:#f92672>.</span>create_sheet(sheet_gennerater<span style=color:#f92672>.</span>title)
</span></span><span style=display:flex><span>            sheet_gennerater_list[n]<span style=color:#f92672>.</span>sheeter <span style=color:#f92672>=</span> _sheet
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> sheet_gennerate <span style=color:#f92672>in</span> sheet_gennerater_list:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> sheet_gennerate<span style=color:#f92672>.</span>sheeter:
</span></span><span style=display:flex><span>            sheet_gennerate<span style=color:#f92672>.</span>full_sheet(data[sheet_gennerate<span style=color:#f92672>.</span>key])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># save workbook to output file</span>
</span></span><span style=display:flex><span>    workbook<span style=color:#f92672>.</span>save(output_path)
</span></span></code></pre></div><h1 id=计算md5>计算md5
<a class=anchor href=#%e8%ae%a1%e7%ae%97md5>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calculate_md5</span>(input_string):
</span></span><span style=display:flex><span>    md5_hash <span style=color:#f92672>=</span> hashlib<span style=color:#f92672>.</span>md5()
</span></span><span style=display:flex><span>    md5_hash<span style=color:#f92672>.</span>update(input_string<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-8&#39;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> md5_hash<span style=color:#f92672>.</span>hexdigest()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>input_string <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello, World!&#34;</span>
</span></span><span style=display:flex><span>md5_value <span style=color:#f92672>=</span> calculate_md5(input_string)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;MD5 值为:&#34;</span>, md5_value)
</span></span></code></pre></div><h1 id=定时任务>定时任务
<a class=anchor href=#%e5%ae%9a%e6%97%b6%e4%bb%bb%e5%8a%a1>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> pip install apscheduler
</span></span></code></pre></div><p>可以参看: <a href=https://github.com/IanVzs/WindWhisper/tree/master/scheduler_task>我以前写的定时任务</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents></nav></div></aside></main></body></html>