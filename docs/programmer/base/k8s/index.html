<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="k8s学习 # 常用命令 # kubectl apply -f rcm_log_monut_k8s_pod.yaml kubectl get pod -A kubectl get pod -all-namespaces kubectl get node kubectl get deploy 持久卷 - PersistentVolume kubectl get persistentvolume kubectl describe persistentvolume example-pv kubectl **delete** persistentvolume example-pv 从kubectl cp -n <命名空间> -c :xxx.json xxx.json 常用字段 # 下面是一些 Kubernetes 中常用的配置字段：
apiVersion： Kubernetes API 的版本，用于定义资源的 API 版本号。 kind： 资源的类型，比如 Pod、Deployment、Service 等。 metadata： 元数据字段，用于存储 Kubernetes 对象的名称、命名空间、标签等信息。 spec： 对象的规格，用于定义对象的期望状态，如 Pod 的容器、Service 的端口等。 status： 对象的状态，用于记录对象的实际状态，如 Pod 的运行状态、Service 的访问地址等。 另外还有一些常用的子字段，如："><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="k8s"><meta property="og:description" content="k8s学习 # 常用命令 # kubectl apply -f rcm_log_monut_k8s_pod.yaml kubectl get pod -A kubectl get pod -all-namespaces kubectl get node kubectl get deploy 持久卷 - PersistentVolume kubectl get persistentvolume kubectl describe persistentvolume example-pv kubectl **delete** persistentvolume example-pv 从kubectl cp -n <命名空间> -c :xxx.json xxx.json 常用字段 # 下面是一些 Kubernetes 中常用的配置字段：
apiVersion： Kubernetes API 的版本，用于定义资源的 API 版本号。 kind： 资源的类型，比如 Pod、Deployment、Service 等。 metadata： 元数据字段，用于存储 Kubernetes 对象的名称、命名空间、标签等信息。 spec： 对象的规格，用于定义对象的期望状态，如 Pod 的容器、Service 的端口等。 status： 对象的状态，用于记录对象的实际状态，如 Pod 的运行状态、Service 的访问地址等。 另外还有一些常用的子字段，如："><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/docs/programmer/base/k8s/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-03-27T10:58:56+00:00"><meta property="article:modified_time" content="2023-03-27T10:58:56+00:00"><title>k8s | Ian's Blog</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.2de198ac08fb15eaacadc891cb7e5e4f6c711b6a01e17552f2af21c5a04e7280.js integrity="sha256-LeGYrAj7FeqsrciRy35eT2xxG2oB4XVS8q8hxaBOcoA=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Ian's Blog</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/docs/programmer/>程序员笔记</a><ul><li><input type=checkbox id=section-52f633cba5cf47818d8ec01e928396f2 class=toggle checked>
<label for=section-52f633cba5cf47818d8ec01e928396f2 class="flex justify-between"><a role=button>Base</a></label><ul><li><a href=/docs/programmer/base/k8s/ class=active>k8s</a></li><li><a href=/docs/programmer/base/pypi/>PyPi</a></li><li><a href=/docs/programmer/base/tipsofweb/>Nginx高可用</a></li><li><a href=/docs/programmer/base/for_china/>各个软件换源</a></li><li><a href=/docs/programmer/base/tipsofdebugers/>tips Of Debuggers</a></li><li><a href=/docs/programmer/base/notesdjango/>Django的建站的(｡･･)ﾉﾞ</a></li><li><a href=/docs/programmer/base/tipsofvim/>tip Of vim</a></li><li><a href=/docs/programmer/base/editer/>编辑器使用</a></li><li><a href=/docs/programmer/base/noteoflinux/>Linux</a></li><li><a href=/docs/programmer/base/tip_dgraph/>Dgraph</a></li><li><a href=/docs/programmer/base/noteoffmtdata/>数据格式笔记</a></li></ul></li><li><input type=checkbox id=section-bf4e0d6f0b81f7b3ec08ed1fc66b874d class=toggle>
<label for=section-bf4e0d6f0b81f7b3ec08ed1fc66b874d class="flex justify-between"><a role=button>Langs</a></label><ul><li><a href=/docs/programmer/langs/cmake/>CMake 使用Tips</a></li><li><a href=/docs/programmer/langs/noteofgoexp/>Golang进阶笔记</a></li><li><a href=/docs/programmer/langs/noteofgolang/>Golang笔记</a></li><li><a href=/docs/programmer/langs/tipsofmarkdown/>tips Of markdown</a></li><li><a href=/docs/programmer/langs/notespython/>Python笔记(notes of Python)</a></li><li><a href=/docs/programmer/langs/notesjava/>愉快的Java(happy to learn the fuck java)</a></li></ul></li><li><input type=checkbox id=section-cd029da01a5cf373a5379dc078a74f2c class=toggle>
<label for=section-cd029da01a5cf373a5379dc078a74f2c class="flex justify-between"><a role=button>Game and Simulation</a></label><ul><li><a href=/docs/programmer/game_and_simulation/blender/>Blender</a></li><li><a href=/docs/programmer/game_and_simulation/noteofue4/>UE4 笔记</a></li></ul></li><li><input type=checkbox id=section-883e27361d38e16afb68faff3435ac0b class=toggle>
<label for=section-883e27361d38e16afb68faff3435ac0b class="flex justify-between"><a role=button>Ml</a></label><ul><li><a href=/docs/programmer/ml/tensorflow/>Tensorflow</a></li><li><a href=/docs/programmer/ml/opencv/>OpenCV</a></li><li><a href=/docs/programmer/ml/paddle/>Paddle</a></li><li><a href=/docs/programmer/ml/noteofmachinelearning/>机器学习库</a></li></ul></li><li><input type=checkbox id=section-7e5360c5e7954906b897ed79085884b6 class=toggle>
<label for=section-7e5360c5e7954906b897ed79085884b6 class="flex justify-between"><a href=/docs/programmer/gui/>Gui</a></label><ul><li><a href=/docs/programmer/gui/pyinstaller/>python打包</a></li><li><a href=/docs/programmer/gui/qt/>Qt/PySide</a></li><li><a href=/docs/programmer/gui/noteofvn_py/>Vn.Py学习笔记（Python交易平台框架）</a></li><li><a href=/docs/programmer/gui/notespython/>图形化界面 （Python Gui）</a></li></ul></li><li><input type=checkbox id=section-4446dd07527142b855f26d7cc8f0e617 class=toggle>
<label for=section-4446dd07527142b855f26d7cc8f0e617 class="flex justify-between"><a role=button>Database</a></label><ul><li><a href=/docs/programmer/database/dgraph/>Dgraph使用小记</a></li><li><a href=/docs/programmer/database/noteofdocker/>notes Of docker</a></li><li><a href=/docs/programmer/database/noteofdbdata/>db数据库</a></li></ul></li><li><input type=checkbox id=section-de7bfad1d124522974cdf8addfbb23f2 class=toggle>
<label for=section-de7bfad1d124522974cdf8addfbb23f2 class="flex justify-between"><a role=button>Net</a></label><ul><li><a href=/docs/programmer/net/tipsofgrpc/>gRpc使用小记</a></li><li><a href=/docs/programmer/net/net/>网络(Computer Network)</a></li></ul></li><li><input type=checkbox id=section-d325c59fc6513e1b1e05a60b192d4973 class=toggle>
<label for=section-d325c59fc6513e1b1e05a60b192d4973 class="flex justify-between"><a href=/docs/programmer/hardware/>Hardware</a></label><ul><li><a href=/docs/programmer/hardware/android/>Android</a></li><li><a href=/docs/programmer/hardware/raspberrypi/>Raspberry Pi</a></li><li><a href=/docs/programmer/hardware/readme/>Readme</a></li><li><a href=/docs/programmer/hardware/screen/>Screen</a></li></ul></li><li><input type=checkbox id=section-40d35e91afa620ff2e7bf6291cfb3e1d class=toggle>
<label for=section-40d35e91afa620ff2e7bf6291cfb3e1d class="flex justify-between"><a href=/docs/programmer/software/>Software</a></label><ul><li><a href=/docs/programmer/software/bash/>Bash</a></li><li><a href=/docs/programmer/software/freebsd/>Freebsd</a></li><li><a href=/docs/programmer/software/gitbook/>Gitbook</a></li><li><a href=/docs/programmer/software/markdown/>Markdown</a></li><li><a href=/docs/programmer/software/npm/>Npm</a></li><li><a href=/docs/programmer/software/readme/>Readme</a></li><li><a href=/docs/programmer/software/vim/>Vim</a></li></ul></li><li><a href=/docs/programmer/install_some/>安装问题</a></li><li><a href=/docs/programmer/demo_test_some/>Demo Test项目中的一些东西</a></li><li><a href=/docs/programmer/tipsofproblems/>解决问题</a></li></ul></li><li class=book-section-flat><a href=/docs/example/>Example Site</a><ul><li><a href=/docs/example/table-of-contents/>Table of Contents</a><ul><li><a href=/docs/example/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/example/table-of-contents/without-toc/>Without ToC</a></li></ul></li></ul></li><li class=book-section-flat><span>Shortcodes</span><ul><li><a href=/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/docs/shortcodes/columns/>Columns</a></li><li><a href=/docs/shortcodes/details/>Details</a></li><li><a href=/docs/shortcodes/expand/>Expand</a></li><li><a href=/docs/shortcodes/hints/>Hints</a></li><li><input type=checkbox id=section-d3fc1bf6d66cd84b896a0af9f40cb1d5 class=toggle>
<label for=section-d3fc1bf6d66cd84b896a0af9f40cb1d5 class="flex justify-between"><a href=/docs/shortcodes/section/>Section</a></label><ul><li><a href=/docs/shortcodes/section/first-page/>First Page</a></li><li><a href=/docs/shortcodes/section/second-page/>Second Page</a></li></ul></li><li><a href=/docs/shortcodes/tabs/>Tabs</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>k8s</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#常用命令>常用命令</a></li><li><a href=#常用字段>常用字段</a></li><li><a href=#其他>其他</a><ul><li><a href=#annotations>annotations</a></li><li><a href=#ownerreferences-字段>ownerReferences 字段</a></li><li><a href=#ownerreferences-中的name和该pod-name相同有什么作用>ownerReferences 中的name和该pod name相同有什么作用？</a></li><li><a href=#env-环境变量>env 环境变量</a></li><li><a href=#initcontainers>initContainers</a></li><li><a href=#一些杂项>一些杂项</a></li></ul></li><li><a href=#a-name持久卷持久卷---persistentvolumea>持久卷 - PersistentVolume</a></li><li><a href=#知识问答>知识问答</a><ul><li><a href=#1-nodeselector-和-nodeselectorterms-有什么区别>1. nodeSelector 和 nodeSelectorTerms 有什么区别？</a></li></ul></li></ul></nav></aside></header><article class=markdown><p><img src=https://d33wubrfki0l68.cloudfront.net/69e55f968a6f44613384615c6a78b881bfe28bd6/1600c/zh-cn/_common-resources/images/flower.svg alt=k8s></p><h1 id=k8s学习>k8s学习
<a class=anchor href=#k8s%e5%ad%a6%e4%b9%a0>#</a></h1><h2 id=常用命令>常用命令
<a class=anchor href=#%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4>#</a></h2><ul><li>kubectl apply -f rcm_log_monut_k8s_pod.yaml</li><li>kubectl get pod -A</li><li>kubectl get pod -all-namespaces</li><li>kubectl get node</li><li>kubectl get deploy</li><li><a href=#%e6%8c%81%e4%b9%85%e5%8d%b7>持久卷 - PersistentVolume</a><ul><li>kubectl get persistentvolume</li><li>kubectl describe persistentvolume example-pv</li><li><code>kubectl **delete** persistentvolume example-pv</code></li></ul></li><li>从kubectl cp -n &lt;命名空间> -c :xxx.json xxx.json</li></ul><h2 id=常用字段>常用字段
<a class=anchor href=#%e5%b8%b8%e7%94%a8%e5%ad%97%e6%ae%b5>#</a></h2><p>下面是一些 Kubernetes 中常用的配置字段：</p><pre tabindex=0><code>apiVersion： Kubernetes API 的版本，用于定义资源的 API 版本号。
kind： 资源的类型，比如 Pod、Deployment、Service 等。
metadata： 元数据字段，用于存储 Kubernetes 对象的名称、命名空间、标签等信息。
spec： 对象的规格，用于定义对象的期望状态，如 Pod 的容器、Service 的端口等。
status： 对象的状态，用于记录对象的实际状态，如 Pod 的运行状态、Service 的访问地址等。
</code></pre><p>另外还有一些常用的子字段，如：</p><pre tabindex=0><code>containers： Pod 中的容器定义，包括容器名称、镜像、命令、参数等。
ports： Service 中的端口定义，包括端口名称、协议、端口号、目标端口号等。
selector： Service 中用于选择后端 Pod 的标签选择器。
replicas： Deployment 中期望的副本数。
template： Deployment 中用于创建 Pod 的 PodTemplateSpec 定义。
</code></pre><h2 id=其他>其他
<a class=anchor href=#%e5%85%b6%e4%bb%96>#</a></h2><p>在 Kubernetes 中，annotations 字段是资源对象中的一个元数据字段，用于存储一些非标准化的元数据信息。与 metadata 字段中的标准化信息不同，annotations 字段中存储的信息往往是自定义的、不易归类的数据，比如代码库的提交 ID、配置文件的 MD5 校验值、外部系统的关联信息等等。</p><h3 id=annotations>annotations
<a class=anchor href=#annotations>#</a></h3><p>字段的格式为一个 key-value 对的列表，其中 key 表示注解的名称，value 表示注解的值。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-pod</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>		<span style=color:#f92672>commit-id</span>: <span style=color:#ae81ff>abc123</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>	- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-container</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-image</span>
</span></span></code></pre></div><p>在这个示例中，我们在 Pod 的 metadata 中添加了一个自定义注解 commit-id，并将其值设置为 abc123。这个注解表示当前 Pod 对应的代码库的提交 ID。</p><p>需要注意的是，由于 annotations 字段是用于存储自定义元数据信息的，因此在使用时需要注意避免与其他标准化的字段发生冲突，以免产生意外的后果。同时，由于注解的值可以是任意字符串，因此需要对注解的内容进行适当的验证和转义，以避免安全风险</p><h3 id=ownerreferences-字段>ownerReferences 字段
<a class=anchor href=#ownerreferences-%e5%ad%97%e6%ae%b5>#</a></h3><p>在 Kubernetes 中，ownerReferences 字段是资源对象中的一个元数据字段，用于指定当前对象的所有者（owner）。这个字段可以用来建立资源对象之间的父子关系，便于管理和垃圾回收。在一个资源对象中，可以同时指定多个父对象（owner）。</p><p>ownerReferences 字段的格式为一个包含多个 ownerReference 对象的列表。每个 ownerReference 对象表示一个父对象的引用，其中包含了父对象的 API 版本、资源类型、名称和 UID。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-pod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ownerReferences</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>uid</span>: <span style=color:#ae81ff>abc123</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ReplicaSet</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-replicaset</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>uid</span>: <span style=color:#ae81ff>def456</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-container</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-image</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>这段 YAML 文件描述了一个名为 my-pod 的 Pod 对象，它有两个父对象，分别是一个 Deployment 和一个 ReplicaSet。其中，Deployment 的名称为 my-deployment，UID 为 abc123，ReplicaSet 的名称为 my-replicaset，UID 为 def456。</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>该 Pod 中只包含一个容器，名称为 my-container，使用镜像为 my-image。</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>需要注意的是，这个 Pod 对象的 ownerReferences 字段表示它是 Deployment 和 ReplicaSet 的子对象，当这两个父对象被删除时，该 Pod 对象也会被自动删除。另外，这个 Pod 对象和其父对象都属于同一个命名空间，因为没有在 metadata 中指定 namespace 字段</span>
</span></span></code></pre></div><p>在这个示例中，我们在 Pod 的 metadata 中添加了两个父对象，分别是一个 Deployment 和一个 ReplicaSet。这些信息可以帮助 Kubernetes 更好地管理这些对象之间的依赖关系，便于进行垃圾回收和版本控制。</p><p>需要注意的是，ownerReferences 字段中的对象必须是同一个命名空间中的资源对象，否则会引发错误。另外，在使用 ownerReferences 字段时需要注意避免循环引用的问题，以免产生意外的后果。</p><h3 id=ownerreferences-中的name和该pod-name相同有什么作用>ownerReferences 中的name和该pod name相同有什么作用？
<a class=anchor href=#ownerreferences-%e4%b8%ad%e7%9a%84name%e5%92%8c%e8%af%a5pod-name%e7%9b%b8%e5%90%8c%e6%9c%89%e4%bb%80%e4%b9%88%e4%bd%9c%e7%94%a8>#</a></h3><p>在 Kubernetes 中，如果一个资源对象的 ownerReferences 中的 name 字段与当前对象的 metadata 中的 name 字段相同，表示当前对象是父对象（owner）自己创建的。这种情况下，父对象的控制器不会对这个对象进行垃圾回收，因为这个对象本身就是父对象的一部分。</p><p>例如，在一个 Deployment 中创建了一个 Pod，并且将 Pod 的 ownerReferences 中的 name 字段设置为 Pod 的名称。这样一来，当 Deployment 被删除时，由于 Pod 依赖于 Deployment，Kubernetes 会先删除 Deployment，然后再删除 Pod。在删除 Pod 时，由于 Pod 的 ownerReferences 中的 name 字段与 Pod 的 metadata 中的 name 字段相同，所以控制器不会对 Pod 进行垃圾回收，而是保留下来作为 Deployment 的一部分。</p><p>通过这种方式，我们可以在 Kubernetes 中建立资源对象之间更加复杂的关系，实现更高级别的控制和管理。例如，可以通过设置 ownerReferences 字段来建立 Deployment 和 Service 的关系，从而实现负载均衡和服务发现。</p><h3 id=env-环境变量>env 环境变量
<a class=anchor href=#env-%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>POD_IP_ADDRESS</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>fieldRef</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>fieldPath</span>: <span style=color:#ae81ff>status.podIP</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>POD_OWN_NAME</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>fieldRef</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>fieldPath</span>: <span style=color:#ae81ff>metadata.name</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>POD_OWN_NAMESPACE</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>fieldRef</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>fieldPath</span>: <span style=color:#ae81ff>metadata.namespace</span>
</span></span></code></pre></div><p>这段 YAML 文件描述了一个 Pod 中的三个环境变量。这些环境变量的值是从 Kubernetes 中获取的，而不是直接在 Pod 中指定的。</p><p>其中，POD_IP_ADDRESS 环境变量的值使用了 valueFrom 字段，并指定了一个 fieldRef，用于从当前 Pod 的状态中获取 podIP 字段的值。POD_IP_ADDRESS 环境变量的值就是当前 Pod 的 IP 地址。</p><p>POD_OWN_NAME 和 POD_OWN_NAMESPACE 环境变量的值也使用了 valueFrom 字段，并指定了一个 fieldRef，用于从当前 Pod 的元数据中获取 name 和 namespace 字段的值。POD_OWN_NAME 环境变量的值就是当前 Pod 的名称，POD_OWN_NAMESPACE 环境变量的值就是当前 Pod 所属的命名空间。</p><p>这种方式可以让我们在定义 Pod 时，动态地获取 Pod 自身的元数据和状态信息，并将这些信息作为环境变量传递给 Pod 中的容器。在容器中，我们可以通过读取这些环境变量的值，来获取当前 Pod 的一些重要信息</p><h3 id=initcontainers>initContainers
<a class=anchor href=#initcontainers>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>dnsPolicy</span>: <span style=color:#ae81ff>ClusterFirst</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>enableServiceLinks</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>initContainers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>sh</span>
</span></span><span style=display:flex><span>    - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>until nc -zvw3 hello-redis-svc.hello-prod.svc.cluster.local 6379; do echo Waiting</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>hello-redis; sleep 5; done;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>xxxx.docker.io/hello-docker/busybox:1.28.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>init-redis</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>terminationMessagePath</span>: <span style=color:#ae81ff>/dev/termination-log</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>terminationMessagePolicy</span>: <span style=color:#ae81ff>File</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/run/secrets/kubernetes.io/serviceaccount</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kube-api-access-pp4tg</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>sh</span>
</span></span><span style=display:flex><span>    - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>until nc -zvw3 hello-mongodb-svc.hello.svc.cluster.local 27017; do echo Waiting</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>hello-mongodb; sleep 5; done;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>xxxx.docker.io/hello-docker/busybox:1.28.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>init-mongodb</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>terminationMessagePath</span>: <span style=color:#ae81ff>/dev/termination-log</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>terminationMessagePolicy</span>: <span style=color:#ae81ff>File</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/run/secrets/kubernetes.io/serviceaccount</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kube-api-access-pp4tg</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><ul><li>这段 YAML 配置是关于 Kubernetes 中的初始化容器（initContainers）的。</li><li>初始化容器是在 Pod 中所有容器启动之前运行的容器，用于预处理或准备容器的某些方面。</li><li>在这个 YAML 配置中，定义了两个初始化容器 <code>init-redis</code> 和 <code>init-mongodb</code>，分别检查 hello-redis 和 hello-mongodb 是否准备就绪。具体地，这两个初始化容器在容器内运行了一个 until 循环，每 5 秒尝试连接 hello-redis 或 hello-mongodb 服务，并打印 Waiting hello-redis 或 Waiting hello-mongodb 的日志信息。如果连接成功，则退出循环，容器初始化成功。初始化容器的镜像是 <code>xxxx.docker.io/hello-docker/busybox:1.28.1</code>，使用 IfNotPresent 策略拉取镜像。其中 <code>resources</code> 字段定义了该容器的资源限制和请求，<code>volumeMounts</code> 字段定义了将哪些存储卷挂载到该容器的哪些路径。</li></ul><h3 id=一些杂项>一些杂项
<a class=anchor href=#%e4%b8%80%e4%ba%9b%e6%9d%82%e9%a1%b9>#</a></h3><ul><li>nodeName: Pod所要调度的节点名称。</li><li>nodeSelector: 用于指定Pod所需的标签，使Pod只能被具有特定标签的节点调度。</li><li>preemptionPolicy: Pod优先级抢占策略。如果当前节点资源不足，可以抢占优先级低的Pod来为优先级高的Pod腾出资源。PreemptLowerPriority表示低优先级的Pod可以被抢占。</li><li>priority: Pod的优先级，数值越高表示优先级越高。</li><li>restartPolicy: Pod的重启策略，可以是Always、OnFailure或Never。Always表示Pod一旦终止就会自动重启，OnFailure表示只有在非0退出码时才会重启，Never表示不会自动重启。</li><li>schedulerName: 指定Pod使用的调度器。</li><li>securityContext: Pod的安全上下文。</li><li>serviceAccount: 默认使用的服务账户。</li><li>serviceAccountName: 指定使用的服务账户名称。</li><li>terminationGracePeriodSeconds: Pod终止的优雅期，即Pod终止时等待多长时间后强制终止。默认为30秒</li><li>其余一些状态信息 <code>status</code> : <code>podIPs</code> <code>phase: Running</code> <code>phase</code> <code>initContainerStatuses</code> <code>containerStatuses</code> <code>containerStatuses</code> <code>conditions</code></li></ul><h2 id=a-name持久卷持久卷---persistentvolumea>持久卷 - PersistentVolume
<a class=anchor href=#a-name%e6%8c%81%e4%b9%85%e5%8d%b7%e6%8c%81%e4%b9%85%e5%8d%b7---persistentvolumea>#</a></h2><p>需要注意的是，<code>PersistentVolume</code>
是一个集群级别的资源，不属于任何一个命名空间，但可以通过在 <code>metadata</code>
字段中指定 <code>namespace</code>
字段来将其关联到某个命名空间中。这个关联只是用来方便查找和管理资源，不会对 <code>PersistentVolume</code>
对象本身产生影响。</p><h2 id=知识问答>知识问答
<a class=anchor href=#%e7%9f%a5%e8%af%86%e9%97%ae%e7%ad%94>#</a></h2><h3 id=1-nodeselector-和-nodeselectorterms-有什么区别>1. nodeSelector 和 nodeSelectorTerms 有什么区别？
<a class=anchor href=#1-nodeselector-%e5%92%8c-nodeselectorterms-%e6%9c%89%e4%bb%80%e4%b9%88%e5%8c%ba%e5%88%ab>#</a></h3><blockquote><p>ChatGPT:</p></blockquote><ul><li>在 Kubernetes 中，nodeSelector 和 nodeSelectorTerms 都是用来选择哪些节点可以运行 Pod 的。</li><li>nodeSelector 是 PodSpec 中的一个字段，它用于指定一个键值对，只有运行在具有指定标签的节点上的 Pod 才会被调度到该节点上。例如：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubernetes.io/hostname</span>: <span style=color:#ae81ff>node-1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-image</span>
</span></span></code></pre></div><p>在上面的示例中，nodeSelector 字段指定了 Pod 只能调度到具有标签 kubernetes.io/hostname=node-1 的节点上。
而 nodeSelectorTerms 是一个更高级别的机制，它允许在一个 Pod 中指定多个选择条件。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>      - {<span style=color:#f92672>key: zone, operator: In, values</span>: [<span style=color:#ae81ff>east, west]}</span>
</span></span><span style=display:flex><span>      - {<span style=color:#f92672>key: region, operator: NotIn, values</span>: [<span style=color:#ae81ff>us-east-1]}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>environment</span>: <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-image</span>
</span></span></code></pre></div><p>在上面的示例中，nodeSelector 字段指定了多个选择条件。其中 matchExpressions 指定了两个表达式，一个是 zone 标签的值必须是 east 或 west，另一个是 region 标签的值不能是 us-east-1。而 matchLabels 指定了 environment 标签的值必须是 production。</p><p>因此，nodeSelector 只能指定一个选择条件，而 nodeSelectorTerms 可以指定多个选择条件。\</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#常用命令>常用命令</a></li><li><a href=#常用字段>常用字段</a></li><li><a href=#其他>其他</a><ul><li><a href=#annotations>annotations</a></li><li><a href=#ownerreferences-字段>ownerReferences 字段</a></li><li><a href=#ownerreferences-中的name和该pod-name相同有什么作用>ownerReferences 中的name和该pod name相同有什么作用？</a></li><li><a href=#env-环境变量>env 环境变量</a></li><li><a href=#initcontainers>initContainers</a></li><li><a href=#一些杂项>一些杂项</a></li></ul></li><li><a href=#a-name持久卷持久卷---persistentvolumea>持久卷 - PersistentVolume</a></li><li><a href=#知识问答>知识问答</a><ul><li><a href=#1-nodeselector-和-nodeselectorterms-有什么区别>1. nodeSelector 和 nodeSelectorTerms 有什么区别？</a></li></ul></li></ul></nav></div></aside></main></body></html>