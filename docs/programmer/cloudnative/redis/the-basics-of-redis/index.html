<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="基础理论 # 概况 # Redis (Remote Dictionary Server) 是一个开源的、支持网络、基于内存、可选持久性的键值对数据库。它支持多种类型的数据结构，如字符串（strings）、列表（lists）、集合（sets）、有序集合（sorted sets）以及散列（hashes）、位图（bitmaps）、超日志（hyperloglogs）和地理空间（geospatial）索引半径查询。
特点包括：
高性能：因为数据主要在内存中进行操作，读写速度非常快。 丰富的数据类型：提供多种数据结构来满足不同场景下的需求。 原子性：所有操作都是原子性的，支持事务（通过MULTI/EXEC命令）。 丰富的功能：支持发布订阅、Lua脚本、事务等。 数据结构 # Redis提供的数据结构包括： Redis 支持多种数据类型，以下是一些常用的数据类型以及它们的简要描述和使用场景：
数据类型 描述 使用场景 String 二进制安全字符串，最大可以存储 512MB 存储文本或二进制数据，如缓存用户个人信息等 List 有序集合，按插入顺序排序 消息队列、时间线、最新消息列表 Set 无序集合，元素不重复 标签、社交网络中的朋友关系等 Sorted Set 有序集合，元素不重复，并且每个元素都会关联一个浮点数分数 排行榜、带权重的集合 Hash 键值对集合，适用于存储对象 存储、访问和修改对象属性 Bitmaps 通过位来表示数据的数据类型，适合做计数统计 在线状态、特性标志、统计等 HyperLogLog 近似去重计数的数据结构 大数据量的计数，如统计独立 IP 访问数量 Geospatial 存储地理位置信息，并进行相关地理操作 储存经纬度，查询附近的地点 Streams Redis 5.0 新增的数据类型，是一个可持久化的日志数据结构 实现消息队列，发布/订阅模式，日志记录 Redis 之所以快速，主要原因有以下几点： # 内存存储：Redis 将所有数据存储在内存中，内存的读写速度远高于硬盘。 数据结构简单：Redis 的数据结构设计简单直观，易于高效操作。 非阻塞 IO：Redis 使用非阻塞 IO 和多路复用技术，可以处理多个并发连接。 单线程模型：Redis 大部分操作是单线程执行，避免了多线程的上下文切换开销。 Redis高性能IO模型 # Redis的IO模型使用的是非阻塞IO复用技术，主要是epoll作为IO多路复用技术的实现方式。它通过单线程事件循环来处理所有客户端请求，确保绝大部分请求都是非阻塞的，并且使用异步编程模式来提高性能。"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Redis基础"><meta property="og:description" content="基础理论 # 概况 # Redis (Remote Dictionary Server) 是一个开源的、支持网络、基于内存、可选持久性的键值对数据库。它支持多种类型的数据结构，如字符串（strings）、列表（lists）、集合（sets）、有序集合（sorted sets）以及散列（hashes）、位图（bitmaps）、超日志（hyperloglogs）和地理空间（geospatial）索引半径查询。
特点包括：
高性能：因为数据主要在内存中进行操作，读写速度非常快。 丰富的数据类型：提供多种数据结构来满足不同场景下的需求。 原子性：所有操作都是原子性的，支持事务（通过MULTI/EXEC命令）。 丰富的功能：支持发布订阅、Lua脚本、事务等。 数据结构 # Redis提供的数据结构包括： Redis 支持多种数据类型，以下是一些常用的数据类型以及它们的简要描述和使用场景：
数据类型 描述 使用场景 String 二进制安全字符串，最大可以存储 512MB 存储文本或二进制数据，如缓存用户个人信息等 List 有序集合，按插入顺序排序 消息队列、时间线、最新消息列表 Set 无序集合，元素不重复 标签、社交网络中的朋友关系等 Sorted Set 有序集合，元素不重复，并且每个元素都会关联一个浮点数分数 排行榜、带权重的集合 Hash 键值对集合，适用于存储对象 存储、访问和修改对象属性 Bitmaps 通过位来表示数据的数据类型，适合做计数统计 在线状态、特性标志、统计等 HyperLogLog 近似去重计数的数据结构 大数据量的计数，如统计独立 IP 访问数量 Geospatial 存储地理位置信息，并进行相关地理操作 储存经纬度，查询附近的地点 Streams Redis 5.0 新增的数据类型，是一个可持久化的日志数据结构 实现消息队列，发布/订阅模式，日志记录 Redis 之所以快速，主要原因有以下几点： # 内存存储：Redis 将所有数据存储在内存中，内存的读写速度远高于硬盘。 数据结构简单：Redis 的数据结构设计简单直观，易于高效操作。 非阻塞 IO：Redis 使用非阻塞 IO 和多路复用技术，可以处理多个并发连接。 单线程模型：Redis 大部分操作是单线程执行，避免了多线程的上下文切换开销。 Redis高性能IO模型 # Redis的IO模型使用的是非阻塞IO复用技术，主要是epoll作为IO多路复用技术的实现方式。它通过单线程事件循环来处理所有客户端请求，确保绝大部分请求都是非阻塞的，并且使用异步编程模式来提高性能。"><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/docs/programmer/cloudnative/redis/the-basics-of-redis/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-05-05T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-05T00:00:00+00:00"><title>Redis基础 | Ian's Blog</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.51ebe0a7a4908742d4f45d6af35fa3972572c7844100f518b8c72186e68ababa.js integrity="sha256-Uevgp6SQh0LU9F1q81+jlyVyx4RBAPUYuMchhuaKuro=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Ian's Blog</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/docs/programmer/>程序员笔记</a><ul><li><input type=checkbox id=section-de7bfad1d124522974cdf8addfbb23f2 class=toggle>
<label for=section-de7bfad1d124522974cdf8addfbb23f2 class="flex justify-between"><a role=button>Net</a></label><ul><li><a href=/docs/programmer/net/tools/ngrok/>ngrok - 一个免费内网穿透api工具</a></li><li><a href=/docs/programmer/net/crawler/mitmproxy/>mitmproxy</a></li><li><a href=/docs/programmer/net/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/>网络编程</a></li><li><a href=/docs/programmer/net/nginx%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE/>Nginx实用配置</a></li><li><a href=/docs/programmer/net/tips-of-grpc/>gRpc使用小记</a></li><li><a href=/docs/programmer/net/epoll%E5%AE%9E%E7%8E%B0/>Epoll实现</a></li></ul></li><li><input type=checkbox id=section-d5f99046a51e5e750b61f2e037945fcc class=toggle>
<label for=section-d5f99046a51e5e750b61f2e037945fcc class="flex justify-between"><a role=button>基础工具和配置</a></label><ul><li><a href=/docs/programmer/basetc/curl/>curl</a></li><li><a href=/docs/programmer/basetc/%E6%96%87%E6%9C%AC%E4%B8%89%E5%89%91%E5%AE%A2/>文本三剑客</a></li><li><a href=/docs/programmer/basetc/tmux/>Tmux使用笔记</a></li><li><a href=/docs/programmer/basetc/obsidian%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE%E6%8F%92%E4%BB%B6/>Obsidian思维导图插件</a></li><li><a href=/docs/programmer/basetc/for_china/>各个软件换源</a></li><li><a href=/docs/programmer/basetc/tipsofvim/>tip Of vim</a></li><li><a href=/docs/programmer/basetc/editer/>编辑器使用</a></li><li><a href=/docs/programmer/basetc/bash/>Bash</a></li><li><a href=/docs/programmer/basetc/gitbook/>Gitbook</a></li><li><a href=/docs/programmer/basetc/vim/>Vim</a></li><li><a href=/docs/programmer/basetc/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/>supervisor</a></li></ul></li><li><input type=checkbox id=section-0bf4f4329214e20fa67ca3e12c6aad0c class=toggle>
<label for=section-0bf4f4329214e20fa67ca3e12c6aad0c class="flex justify-between"><a role=button>平台</a></label><ul><li><a href=/docs/programmer/platforms/steam/>Steam</a></li><li><a href=/docs/programmer/platforms/ubuntu/>Ubuntu</a></li><li><a href=/docs/programmer/platforms/%E9%98%BF%E9%87%8C%E4%BA%91%E4%BD%BF%E7%94%A8/>阿里云使用</a></li><li><a href=/docs/programmer/platforms/wps-for-linux/>WPS for Linux</a></li><li><a href=/docs/programmer/platforms/appsflyer/>AppsFlyer-外网移动归因营销分析平台</a></li><li><a href=/docs/programmer/platforms/install_some/>安装问题</a></li><li><a href=/docs/programmer/platforms/android/>安卓</a></li><li><a href=/docs/programmer/platforms/freebsd/>FreeBSD</a></li><li><a href=/docs/programmer/platforms/note-of-linux/>Linux 笔记</a></li><li><a href=/docs/programmer/platforms/git/>Git</a></li><li><a href=/docs/programmer/platforms/problem-of-windows/>Windows 爬坑记</a></li><li><a href=/docs/programmer/platforms/tips-of-problems/>解决问题记录笔记</a></li></ul></li><li><input type=checkbox id=section-8658298e10b544e890095f646916165a class=toggle checked>
<label for=section-8658298e10b544e890095f646916165a class="flex justify-between"><a href=/docs/programmer/cloudnative/>云原生</a></label><ul><li><input type=checkbox id=section-31d3b02fd4a132635e483e7e756058ea class=toggle checked>
<label for=section-31d3b02fd4a132635e483e7e756058ea class="flex justify-between"><a href=/docs/programmer/cloudnative/redis/>中间件</a></label><ul><li><a href=/docs/programmer/cloudnative/redis/python-redis-%E5%AE%A2%E6%88%B7%E7%AB%AF/>Python Redis 客户端</a></li><li><a href=/docs/programmer/cloudnative/redis/bigkey-and-hotkey/>大key、热key问题</a></li><li><a href=/docs/programmer/cloudnative/redis/the-basics-of-redis/ class=active>Redis基础</a></li><li><a href=/docs/programmer/cloudnative/redis/advanced-knowledge-of-redis/>Redis进阶</a></li><li><a href=/docs/programmer/cloudnative/redis/%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4/>Redis常用命令</a></li></ul></li><li><input type=checkbox id=section-62d608ed890b3abc76dae78ccfcab912 class=toggle>
<label for=section-62d608ed890b3abc76dae78ccfcab912 class="flex justify-between"><a role=button>k8s</a></label><ul><li><a href=/docs/programmer/cloudnative/k8s/elk%E5%9C%A8k8s%E4%B8%8A%E7%9A%84%E9%83%A8%E7%BD%B2%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/>elk在k8s上的部署使用示例</a></li><li><a href=/docs/programmer/cloudnative/k8s/k8s-%E9%85%8D%E5%A5%97%E8%AF%B4%E6%98%8E/>k8s 配套说明</a></li><li><a href=/docs/programmer/cloudnative/k8s/k8s-%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/>k8s技术分享</a></li><li><a href=/docs/programmer/cloudnative/k8s/k8s%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/>k8s学习-常用命令和配置文件</a></li><li><a href=/docs/programmer/cloudnative/k8s/argo-workflow%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%88%86%E6%9E%90/>Argo Workflow性能测试和使用场景分析</a></li><li><a href=/docs/programmer/cloudnative/k8s/argo-%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/>Argo 使用记录</a></li></ul></li><li><input type=checkbox id=section-b828bf3d116bc282da9db25a06bf908e class=toggle>
<label for=section-b828bf3d116bc282da9db25a06bf908e class="flex justify-between"><a role=button>中间件</a></label><ul><li><a href=/docs/programmer/cloudnative/middleware/kafka-%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/>Kafka 安装和使用</a></li></ul></li><li><a href=/docs/programmer/cloudnative/%E5%AE%B9%E5%99%A8/note-of-podman/>Podman</a></li><li><a href=/docs/programmer/cloudnative/nginx%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE/>Nginx实用配置</a></li><li><a href=/docs/programmer/cloudnative/uwsgi-%E5%A4%84%E7%90%86%E8%AE%B0%E5%BD%95/>uwsgi 处理记录</a></li><li><a href=/docs/programmer/cloudnative/note-of-docker/>Docker</a></li><li><a href=/docs/programmer/cloudnative/%E5%AE%B9%E5%99%A8/note-of-docker/>Docker</a></li><li><a href=/docs/programmer/cloudnative/fastapi/>Django的建站的(｡･･)ﾉﾞ</a></li><li><a href=/docs/programmer/cloudnative/nginx-%E9%AB%98%E5%8F%AF%E7%94%A8/>Nginx高可用</a></li><li><a href=/docs/programmer/cloudnative/notesdjango/>Django的建站的(｡･･)ﾉﾞ</a></li><li><a href=/docs/programmer/cloudnative/sonar-%E4%BB%A3%E7%A0%81%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5/>Sonar 代码静态检查</a></li></ul></li><li><input type=checkbox id=section-883e27361d38e16afb68faff3435ac0b class=toggle>
<label for=section-883e27361d38e16afb68faff3435ac0b class="flex justify-between"><a role=button>机器学习</a></label><ul><li><a href=/docs/programmer/ml/stable-diffusion/>AI画图</a></li><li><a href=/docs/programmer/ml/%E7%88%AC%E8%99%AB/>爬虫</a></li><li><a href=/docs/programmer/ml/paddle/>Paddle</a></li><li><a href=/docs/programmer/ml/tensorflow/>Tensorflow</a></li><li><a href=/docs/programmer/ml/opencv/>OpenCV</a></li><li><a href=/docs/programmer/ml/yolo/>Demo Test项目中的一些东西</a></li><li><a href=/docs/programmer/ml/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B8%B8%E7%94%A8%E5%BA%93%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/>机器学习库</a></li></ul></li><li><input type=checkbox id=section-bf4e0d6f0b81f7b3ec08ed1fc66b874d class=toggle>
<label for=section-bf4e0d6f0b81f7b3ec08ed1fc66b874d class="flex justify-between"><a href=/docs/programmer/langs/>编程语言</a></label><ul><li><input type=checkbox id=section-771df6c720301e69f1715f7fc174ac3d class=toggle>
<label for=section-771df6c720301e69f1715f7fc174ac3d class="flex justify-between"><a role=button>Python</a></label><ul><li><a href=/docs/programmer/langs/python/sqlalchemy/>SqlAlchemy - 数据库Orm</a></li><li><a href=/docs/programmer/langs/python/pypi/>PyPi使用说明</a></li><li><a href=/docs/programmer/langs/python/pytest/>PyTest</a></li><li><a href=/docs/programmer/langs/python/paramiko-%E4%BD%BF%E7%94%A8-sshsftp/>Paramiko 使用 Ssh&amp;sftp</a></li><li><a href=/docs/programmer/langs/python/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%9A%E8%BF%9B%E7%A8%8B/>Python 多线程多进程</a></li><li><a href=/docs/programmer/langs/python/notespython/>Python 常用库</a></li><li><a href=/docs/programmer/langs/python/notespython/>Python 笔记</a></li><li><a href=/docs/programmer/langs/python/py%E5%B0%8F%E5%B7%A5%E5%85%B7%E5%92%8C%E5%8A%9F%E8%83%BD%E6%80%A7%E6%96%B9%E6%B3%95/>Py小工具和功能性方法</a></li><li><a href=/docs/programmer/langs/python/notespython/>解决问题</a></li></ul></li><li><input type=checkbox id=section-9f8ac8f06e138c7ac13ff61f23b4d497 class=toggle>
<label for=section-9f8ac8f06e138c7ac13ff61f23b4d497 class="flex justify-between"><a role=button>Golang</a></label><ul><li><a href=/docs/programmer/langs/golang/advanced-knowledge-of-golang/>Golang进阶笔记</a></li><li><a href=/docs/programmer/langs/golang/noteofgoexp/>Golang进阶笔记</a></li><li><a href=/docs/programmer/langs/golang/note-of-golang/>Golang笔记</a></li><li><a href=/docs/programmer/langs/golang/noteofgolang/>Golang笔记</a></li></ul></li><li><a href=/docs/programmer/langs/cmake/>CMake 使用Tips</a></li><li><a href=/docs/programmer/langs/tips-of-debugers/>Tips of debuggers</a></li><li><a href=/docs/programmer/langs/tips-of-markdown/>Tips of MarkDown</a></li><li><a href=/docs/programmer/langs/java/notesjava/>愉快的Java(happy to learn the fuck java)</a></li><li><a href=/docs/programmer/langs/note-for-fmtdata/>数据格式笔记</a></li></ul></li><li><input type=checkbox id=section-7e5360c5e7954906b897ed79085884b6 class=toggle>
<label for=section-7e5360c5e7954906b897ed79085884b6 class="flex justify-between"><a href=/docs/programmer/gui/>图形用户界面-GUI</a></label><ul><li><input type=checkbox id=section-d68552b374b14edaa2443cb0f45f94f7 class=toggle>
<label for=section-d68552b374b14edaa2443cb0f45f94f7 class="flex justify-between"><a href=/docs/programmer/gui/example/>Blog 构建</a></label><ul><li><input type=checkbox id=section-9610a10c098f6edce85f18e8d27ddc6d class=toggle>
<label for=section-9610a10c098f6edce85f18e8d27ddc6d class="flex justify-between"><a href=/docs/programmer/gui/example/table-of-contents/>Table of Contents</a></label><ul><li><a href=/docs/programmer/gui/example/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/programmer/gui/example/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><input type=checkbox id=section-9ec2030fb4762791e574be1af10795d3 class=toggle>
<label for=section-9ec2030fb4762791e574be1af10795d3 class="flex justify-between"><a href=/docs/programmer/gui/example/shortcodes/>Shortcodes</a></label><ul><li><a href=/docs/programmer/gui/example/shortcodes/buttons/>Buttons</a></li><li><a href=/docs/programmer/gui/example/shortcodes/columns/>Columns</a></li><li><a href=/docs/programmer/gui/example/shortcodes/details/>Details</a></li><li><a href=/docs/programmer/gui/example/shortcodes/expand/>Expand</a></li><li><a href=/docs/programmer/gui/example/shortcodes/hints/>Hints</a></li><li><input type=checkbox id=section-0a13810fcdbb2cfbfd8459e55601b351 class=toggle>
<label for=section-0a13810fcdbb2cfbfd8459e55601b351 class="flex justify-between"><a href=/docs/programmer/gui/example/shortcodes/section/>Section</a></label><ul><li><a href=/docs/programmer/gui/example/shortcodes/section/first-page/>First Page</a></li><li><a href=/docs/programmer/gui/example/shortcodes/section/second-page/>Second Page</a></li></ul></li><li><a href=/docs/programmer/gui/example/shortcodes/tabs/>Tabs</a></li></ul></li></ul></li><li><a href=/docs/programmer/gui/pyinstaller-python%E6%89%93%E5%8C%85/>python打包</a></li><li><a href=/docs/programmer/gui/qt/>Qt/PySide</a></li><li><a href=/docs/programmer/gui/vn.py%E7%AC%94%E8%AE%B0-%E4%BA%A4%E6%98%93%E5%B9%B3%E5%8F%B0%E5%AE%A2%E6%88%B7%E7%AB%AF/>Vn.Py学习笔记（Python交易平台框架）</a></li><li><a href=/docs/programmer/gui/notespython/>图形化界面 （Python Gui）</a></li></ul></li><li><input type=checkbox id=section-4446dd07527142b855f26d7cc8f0e617 class=toggle>
<label for=section-4446dd07527142b855f26d7cc8f0e617 class="flex justify-between"><a href=/docs/programmer/database/>Database</a></label><ul><li><a href=/docs/programmer/database/dgraph-graph-db/>Dgraph使用小记</a></li><li><a href=/docs/programmer/database/note-of-db-data-mongodb/>数据库-MongoDB篇</a></li><li><a href=/docs/programmer/database/note-of-db-data-mysql/>数据库-MySQL篇</a></li></ul></li><li><input type=checkbox id=section-d325c59fc6513e1b1e05a60b192d4973 class=toggle>
<label for=section-d325c59fc6513e1b1e05a60b192d4973 class="flex justify-between"><a href=/docs/programmer/hardware/>硬件</a></label><ul><li><a href=/docs/programmer/hardware/raspberrypi/>Raspberry Pi</a></li><li><a href=/docs/programmer/hardware/screen/>Screen</a></li></ul></li></ul></li><li class=book-section-flat><span>建模和游戏</span><ul><li><a href=/docs/3dgame/blender/>Blender</a></li><li><a href=/docs/3dgame/noteofue4/>UE4 笔记</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Redis基础</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#基础理论>基础理论</a><ul><li><a href=#概况>概况</a></li><li><a href=#数据结构>数据结构</a></li><li><a href=#redis-之所以快速主要原因有以下几点>Redis 之所以快速，主要原因有以下几点：</a></li><li><a href=#持久化机制>持久化机制</a></li><li><a href=#缓存淘汰删>缓存淘汰/删</a></li><li><a href=#阻塞点与异步机制>阻塞点与异步机制</a></li><li><a href=#原子操作管道事务>原子操作、管道、事务</a></li><li><a href=#内存碎片>内存碎片</a></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=基础理论>基础理论
<a class=anchor href=#%e5%9f%ba%e7%a1%80%e7%90%86%e8%ae%ba>#</a></h2><h3 id=概况>概况
<a class=anchor href=#%e6%a6%82%e5%86%b5>#</a></h3><p>Redis (Remote Dictionary Server) 是一个开源的、支持网络、基于内存、可选持久性的键值对数据库。它支持多种类型的数据结构，如字符串（strings）、列表（lists）、集合（sets）、有序集合（sorted sets）以及散列（hashes）、位图（bitmaps）、超日志（hyperloglogs）和地理空间（geospatial）索引半径查询。</p><p>特点包括：</p><ul><li>高性能：因为数据主要在内存中进行操作，读写速度非常快。</li><li>丰富的数据类型：提供多种数据结构来满足不同场景下的需求。</li><li>原子性：所有操作都是原子性的，支持事务（通过MULTI/EXEC命令）。</li><li>丰富的功能：支持发布订阅、Lua脚本、事务等。</li></ul><h3 id=数据结构>数据结构
<a class=anchor href=#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84>#</a></h3><p>Redis提供的数据结构包括：
Redis 支持多种数据类型，以下是一些常用的数据类型以及它们的简要描述和使用场景：</p><table><thead><tr><th>数据类型</th><th>描述</th><th>使用场景</th></tr></thead><tbody><tr><td>String</td><td>二进制安全字符串，最大可以存储 512MB</td><td>存储文本或二进制数据，如缓存用户个人信息等</td></tr><tr><td>List</td><td>有序集合，按插入顺序排序</td><td>消息队列、时间线、最新消息列表</td></tr><tr><td>Set</td><td>无序集合，元素不重复</td><td>标签、社交网络中的朋友关系等</td></tr><tr><td>Sorted Set</td><td>有序集合，元素不重复，并且每个元素都会关联一个浮点数分数</td><td>排行榜、带权重的集合</td></tr><tr><td>Hash</td><td>键值对集合，适用于存储对象</td><td>存储、访问和修改对象属性</td></tr><tr><td>Bitmaps</td><td>通过位来表示数据的数据类型，适合做计数统计</td><td>在线状态、特性标志、统计等</td></tr><tr><td>HyperLogLog</td><td>近似去重计数的数据结构</td><td>大数据量的计数，如统计独立 IP 访问数量</td></tr><tr><td>Geospatial</td><td>存储地理位置信息，并进行相关地理操作</td><td>储存经纬度，查询附近的地点</td></tr><tr><td>Streams</td><td>Redis 5.0 新增的数据类型，是一个可持久化的日志数据结构</td><td>实现消息队列，发布/订阅模式，日志记录</td></tr></tbody></table><h3 id=redis-之所以快速主要原因有以下几点>Redis 之所以快速，主要原因有以下几点：
<a class=anchor href=#redis-%e4%b9%8b%e6%89%80%e4%bb%a5%e5%bf%ab%e9%80%9f%e4%b8%bb%e8%a6%81%e5%8e%9f%e5%9b%a0%e6%9c%89%e4%bb%a5%e4%b8%8b%e5%87%a0%e7%82%b9>#</a></h3><ol><li><strong>内存存储</strong>：Redis 将所有数据存储在内存中，内存的读写速度远高于硬盘。</li><li><strong>数据结构简单</strong>：Redis 的数据结构设计简单直观，易于高效操作。</li><li><strong>非阻塞 IO</strong>：Redis 使用非阻塞 IO 和多路复用技术，可以处理多个并发连接。</li><li><strong>单线程模型</strong>：Redis 大部分操作是单线程执行，避免了多线程的上下文切换开销。</li></ol><h4 id=redis高性能io模型>Redis高性能IO模型
<a class=anchor href=#redis%e9%ab%98%e6%80%a7%e8%83%bdio%e6%a8%a1%e5%9e%8b>#</a></h4><p>Redis的IO模型使用的是非阻塞IO复用技术，主要是epoll作为IO多路复用技术的实现方式。它通过单线程事件循环来处理所有客户端请求，确保绝大部分请求都是非阻塞的，并且使用异步编程模式来提高性能。</p><p>引用一些数据的话，可以提及以下几点：</p><ul><li>内存读写速度：NVMe SSD 的 IOPS 可以达到数十万到数百万，而内存的 IOPS 可以达到千万级别，延迟通常小于100微秒。相比之下，内存的速度通常是硬盘的数千倍甚至更高。</li><li>性能表现：根据 Redis 官方给出的数据，在一个标准 Linux 系统上，Redis 可以达到每秒10万级别的读写操作（这个数字可能因配置、数据类型和具体操作而异）。</li></ul><p>以上数据只是为了说明 Redis 为什么快速，具体的性能指标会根据使用环境、硬件配置以及具体的工作负载而有所变化。</p><h3 id=持久化机制>持久化机制
<a class=anchor href=#%e6%8c%81%e4%b9%85%e5%8c%96%e6%9c%ba%e5%88%b6>#</a></h3><p>Redis提供两种持久化机制：RDB（Snapshotting）和AOF（Append-only file）。</p><ul><li><strong>RDB</strong>：在指定的时间间隔内生成数据集的时间点快照。</li><li><strong>AOF</strong>：记录服务器接收到的每个写操作指令，并在服务器启动时重新执行这些命令来恢复数据。</li></ul><h3 id=缓存淘汰删>缓存淘汰/删
<a class=anchor href=#%e7%bc%93%e5%ad%98%e6%b7%98%e6%b1%b0%e5%88%a0>#</a></h3><p>当内存不足时，Redis会根据配置的策略来移除一些键，以释放空间。常见的淘汰策略包括：</p><ul><li>noeviction：不进行淘汰，返回错误。</li><li>allkeys-lru：从所有键中淘汰最近最少使用的键。</li><li>volatile-lru：从设置了过期时间的键中淘汰最近最少使用的键。</li><li>其他</li></ul><p>Redis 缓存淘汰策略是指当内存使用达到一定阈值时，Redis 会按照特定的策略自动移除一些键值对，以释放空间供新的写入操作使用。以下是 Redis 支持的几种缓存淘汰策略：</p><table><thead><tr><th>策略</th><th>描述</th></tr></thead><tbody><tr><td>noeviction</td><td>不进行任何淘汰，尝试写入导致超出内存限制时返回错误信息</td></tr><tr><td>allkeys-lru</td><td>根据最近最少使用算法（Least Recently Used），淘汰长时间未被查询或修改的键</td></tr><tr><td>volatile-lru</td><td>只根据 LRU 算法淘汰设置了过期时间的键</td></tr><tr><td>allkeys-random</td><td>随机移除键</td></tr><tr><td>volatile-random</td><td>随机移除已经设置了过期时间的键</td></tr><tr><td>volatile-ttl</td><td>移除即将过期的键</td></tr><tr><td>volatile-lfu (>=4.0)</td><td>根据最不经常使用算法（Least Frequently Used），淘汰数据访问频率低的键</td></tr><tr><td>allkeys-lfu (>=4.0)</td><td>同上，但是针对所有键，不仅仅是那些设置了过期时间的键</td></tr></tbody></table><p>在这些策略中，LFU 和 LRU 是基于数据的访问模式来决定哪个键最有可能被淘汰：</p><ul><li><p><strong>LRU（Least Recently Used）</strong>：这种策略假设如果数据最近很少用到，那么在将来也不太可能被用到。因此，当需要淘汰数据来腾出空间时，它会选取最长时间未被访问的数据。</p></li><li><p><strong>LFU（Least Frequently Used）</strong>：这个策略则是基于数据被访问的频率，删除那些访问次数最少的数据。相比于 LRU，LFU 在处理“热点数据”上表现更加出色。</p></li></ul><p>上述淘汰策略可以通过在 <code>redis.conf</code> 文件中设置 <code>maxmemory-policy</code> 来选择，例如：</p><pre tabindex=0><code>maxmemory-policy allkeys-lru
</code></pre><p>Redis 常用的显式删除操作，如：</p><ul><li><code>DEL</code> 命令直接删除一个或多个键。</li><li><code>EXPIRE</code> 命令设置键的过期时间，到期后键自动被删除。</li><li><code>SET</code> 命令在设置新值的同时可以设置过期时间。</li></ul><h3 id=阻塞点与异步机制>阻塞点与异步机制
<a class=anchor href=#%e9%98%bb%e5%a1%9e%e7%82%b9%e4%b8%8e%e5%bc%82%e6%ad%a5%e6%9c%ba%e5%88%b6>#</a></h3><p>Redis 是一个基于事件驱动的服务器，它使用非阻塞 I/O 和事件通知机制来处理并发连接。这意味着 Redis 在执行某些操作时不会被阻塞等待 I/O 操作的完成，从而可以在等待磁盘或网络 I/O 时继续处理其他任务。</p><p><strong>阻塞点</strong>：</p><p>尽管 Redis 大部分操作是非阻塞的，但仍有一些情况会引起阻塞：</p><ul><li>命令 <code>BLPOP</code>、<code>BRPOP</code>、<code>BRPOPLPUSH</code> 用于列表操作时，如果列表为空，会导致客户端阻塞直到有新元素插入。</li><li>发布订阅 (<code>PUBLISH</code>/<code>SUBSCRIBE</code> 命令) 中，客户端可能会等待新消息的到来。</li><li>对于慢查询和大数据量操作（如 <code>KEYS *</code> 或 <code>SMEMBERS</code>），可能会造成临时阻塞。</li></ul><p><strong>异步机制</strong>：</p><p>为了减少阻塞时间，Redis 提供了异步处理能力：</p><ul><li>使用 AOF（Append Only File）日志时，Redis 支持后台异步进行磁盘写入。</li><li>主从同步和 RDB 快照生成也可以异步执行，以避免阻塞主线程。</li><li>客户端可以通过管道（pipelining）技术同时发送多个命令，然后一次性读取所有响应，这样可以减少网络延迟带来的影响。</li></ul><h3 id=原子操作管道事务>原子操作、管道、事务
<a class=anchor href=#%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c%e7%ae%a1%e9%81%93%e4%ba%8b%e5%8a%a1>#</a></h3><p><strong>原子操作</strong>：</p><p>在 Redis 中，单个命令总是原子性执行的。这意味着当一个命令在执行过程中，不会被其他命令打断。例如，<code>INCR</code> 命令增加一个整数值，并返回新值，这个过程是原子的。</p><p><strong>管道（Pipelining）</strong>：</p><p>管道是一种技术，可以将多个命令打包后一次性发送给服务器，而无需等待每个命令的响应。这可以显著提高性能，特别是在高延迟网络环境中。管道减少了网络往返次数，使得批量操作更加高效。</p><p><strong>事务</strong>：</p><p>Redis 的事务功能通过 <code>MULTI</code>、<code>EXEC</code>、<code>DISCARD</code> 和 <code>WATCH</code> 命令实现。一个事务由一系列命令组成，这些命令会被序列化并按顺序执行。以下是事务的关键点：</p><ul><li><code>MULTI</code> 开始一个事务。</li><li>连续输入多个命令，这些命令不会立即执行，而是被放入队列中。</li><li><code>EXEC</code> 执行所有队列中的命令。</li><li>如果在执行 <code>EXEC</code> 之前调用 <code>DISCARD</code>，则可以取消事务。</li><li><code>WATCH</code> 可以监视一个或���个键，如果在事务开始之后任何监视的键被修改，则事务将被中断。</li></ul><h3 id=内存碎片>内存碎片
<a class=anchor href=#%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87>#</a></h3><p>内存碎片是指由于多次申请和释放内存导致可用内存碎片化，从而降低内存使用效率。在 Redis 中，内存碎片化可以因以下原因产生：</p><ul><li>频繁地创建和删除大量的小对象。</li><li>分配给字符串或者列表等数据类型的内存大小动态变化。</li></ul><p>内存碎片问题可能导致 Redis 占用更多的物理内存，超出实际数据需要的大小。可以通过 <code>info memory</code> 命令检查内存相关的统计信息，其中包括内存碎片率（memory fragmentation ratio），当这个比率超过 1.5 时，就说明存在一定的内存碎片问题。</p><p>为了解决内存碎片问题，可以采取以下措施：</p><ul><li>定期重启 Redis 服务。</li><li>使用 jemalloc 等先进的内存分配器。</li><li>适当调整 Redis 中关于对象重用的策略。例如，可以通过调整 maxmemory 策略来控制内存使用，或者使用 lazyfree-lazy-eviction 等参数以更优化的方式释放内存。
优化数据结构和访问模式。比如，尽量避免存储过多的小对象；使用哈希表（hashes）来存储对象集合而非单独的字符串键；对大型列表进行分页处理等。
监控并剔除长时间未使用的键，这可以通过设置键的过期时间（TTL）来实现。</li></ul><p>另外，Redis 4.0 及以上版本引入了 active defragmentation 功能，它允许 Redis 在运行时动态地减少内存碎片，而无需重启服务。这个特性可以在 redis.conf 配置文件中开启，并允许你配置不同的参数来控制碎片整理的行为。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#基础理论>基础理论</a><ul><li><a href=#概况>概况</a></li><li><a href=#数据结构>数据结构</a></li><li><a href=#redis-之所以快速主要原因有以下几点>Redis 之所以快速，主要原因有以下几点：</a></li><li><a href=#持久化机制>持久化机制</a></li><li><a href=#缓存淘汰删>缓存淘汰/删</a></li><li><a href=#阻塞点与异步机制>阻塞点与异步机制</a></li><li><a href=#原子操作管道事务>原子操作、管道、事务</a></li><li><a href=#内存碎片>内存碎片</a></li></ul></li></ul></nav></div></aside></main></body></html>